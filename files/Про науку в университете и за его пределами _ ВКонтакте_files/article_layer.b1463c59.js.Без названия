(()=>{"use strict";var e,t,i,a,r,s,o={993880:(e,t,i)=>{function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M9 9v4a1 1 0 1 1-2 0V9H3a1 1 0 1 1 0-2h4V3a1 1 0 1 1 2 0v4h4a1 1 0 1 1 0 2H9Z"/></svg>',name:"add_16"}}i.d(t,{getIcon16Add:()=>a})},171795:(e,t,i)=>{function a(){return{icon:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.74 3.76c.35.34.35.9 0 1.23l-7.31 7.25a.88.88 0 0 1-1.25 0L2.26 9.36a.87.87 0 0 1 0-1.23.88.88 0 0 1 1.24 0l2.3 2.26 6.7-6.63a.88.88 0 0 1 1.24 0Z" fill="currentColor"/></svg>',name:"done_16"}}i.d(t,{getIcon16Done:()=>a})},946495:(e,t,i)=>{function a(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0zm1.5 0a8.5 8.5 0 1 1-17 0 8.5 8.5 0 0 1 17 0zm-5.22-1.22a.75.75 0 0 0-1.06-1.06L9 10.94 7.78 9.72a.75.75 0 0 0-1.06 1.06l1.75 1.75c.3.3.77.3 1.06 0z" fill="currentColor" fill-rule="evenodd"/></svg>',name:"check_circle_outline_20"}}i.d(t,{getIcon20CheckCircleOutline:()=>a})},257065:(e,t,i)=>{function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M6.26 4.26a.9.9 0 0 1 1.28 0l12.2 12.2a.9.9 0 1 1-1.28 1.28L16 15.27v3.04c0 1-.85 1.69-1.75 1.69-.76 0-1.5-.28-2.06-.8l-4.24-3.93H6.14A2.1 2.1 0 0 1 4 13.22v-2.44a2.1 2.1 0 0 1 2.14-2.05h1.8l.8-.73-2.48-2.46a.9.9 0 0 1 0-1.28Zm3.76 5.03-1.1 1a.9.9 0 0 1-.62.24H6.14a.39.39 0 0 0-.27.1.2.2 0 0 0-.07.15v2.44a.21.21 0 0 0 .07.15c.06.05.15.1.27.1H8.3a.9.9 0 0 1 .61.24l4.5 4.17c.2.19.48.3.79.32v-4.73L10.02 9.3ZM14.25 4c.9 0 1.75.7 1.75 1.69V8a.9.9 0 1 1-1.8 0V5.8a1.23 1.23 0 0 0-.79.32l-.13.12a.9.9 0 1 1-1.22-1.32l.13-.12a3.04 3.04 0 0 1 2.06-.8Z"/></svg>',name:"mute_outline_24"}}i.d(t,{getIcon24MuteOutline:()=>a})},783237:(e,t,i)=>{function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M14.25 4c.9 0 1.75.7 1.75 1.69V18.3c0 1-.85 1.69-1.75 1.69-.76 0-1.5-.28-2.06-.8l-4.24-3.93H6.14A2.1 2.1 0 0 1 4 13.22v-2.44a2.1 2.1 0 0 1 2.14-2.05h1.8L12.2 4.8a3.04 3.04 0 0 1 2.06-.8Zm-.05 1.8a1.23 1.23 0 0 0-.79.32l-4.5 4.17a.9.9 0 0 1-.61.24H6.14c-.14 0-.34.09-.34.25v2.44c0 .16.2.25.34.25H8.3a.9.9 0 0 1 .61.24l4.5 4.17c.2.19.48.3.79.32V5.8Zm7.34.47C23.06 7.79 24 9.79 24 12s-.94 4.2-2.46 5.74a.9.9 0 1 1-1.28-1.27A6.31 6.31 0 0 0 22.2 12a6.3 6.3 0 0 0-1.94-4.46.9.9 0 1 1 1.28-1.27Zm-2.55 3.05C19.6 10.06 20 10.98 20 12s-.39 1.94-1.01 2.68a.9.9 0 0 1-1.38-1.16c.39-.45.59-.98.59-1.52s-.2-1.07-.59-1.52A.9.9 0 0 1 19 9.32Z"/></svg>',name:"volume_outline_24"}}i.d(t,{getIcon24VolumeOutline:()=>a})},542212:(e,t,i)=>{function a(){return{icon:'<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><g id="pause_28__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="pause_28__pause_28"><path id="pause_28__Rectangle-737" d="M0 0h28v28H0z"/><path d="M7.3 5h3.4c.72 0 1.3.58 1.3 1.3v15.4c0 .72-.58 1.3-1.3 1.3H7.3A1.3 1.3 0 0 1 6 21.7V6.3C6 5.58 6.58 5 7.3 5Zm9 0h3.4c.72 0 1.3.58 1.3 1.3v15.4c0 .72-.58 1.3-1.3 1.3h-3.4a1.3 1.3 0 0 1-1.3-1.3V6.3c0-.72.58-1.3 1.3-1.3Z" id="pause_28__Mask" fill="currentColor"/></g></g></svg>',name:"pause_28"}}i.d(t,{getIcon28Pause:()=>a})},32991:(e,t,i)=>{function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 28 28"><path d="M21.65 11.92c1.18.69 1.77 1.03 1.97 1.47.17.39.17.83 0 1.22-.2.44-.79.79-1.97 1.47l-10.05 5.8c-1.18.67-1.77 1.02-2.26.96a1.5 1.5 0 0 1-1.05-.6C8 21.84 8 21.16 8 19.8V8.2c0-1.36 0-2.04.29-2.44a1.5 1.5 0 0 1 1.05-.6c.49-.06 1.08.28 2.26.97l10.05 5.8Z"/></svg>',name:"play_28"}}i.d(t,{getIcon28Play:()=>a})},815535:(e,t,i)=>{function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 28 28"><path fill="#fff" d="M18.13 13.35a.76.76 0 0 1 0 1.3l-5.52 3.25a.74.74 0 0 1-1.11-.65v-6.5c0-.58.61-.94 1.1-.65l5.53 3.25Z"/></svg>',name:"play_marusia_foreground_28"}}i.d(t,{getIcon28PlayMarusiaForeground:()=>a})},158879:(e,t,i)=>{function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 28 28"><path fill="#fff" d="M10 13.2c0-1.12 0-1.68.22-2.1a2 2 0 0 1 .87-.88c.43-.22.99-.22 2.11-.22h1.6c1.12 0 1.68 0 2.1.22a2 2 0 0 1 .88.87c.22.43.22.99.22 2.11v1.6c0 1.12 0 1.68-.22 2.1a2 2 0 0 1-.87.88c-.43.22-.99.22-2.11.22h-1.6c-1.12 0-1.68 0-2.1-.22a2 2 0 0 1-.88-.87c-.22-.43-.22-.99-.22-2.11v-1.6Z"/></svg>',name:"stop_marusia_foreground_28"}}i.d(t,{getIcon28StopMarusiaForeground:()=>a})},161276:(e,t,i)=>{i.d(t,{default:()=>n});var a=i(577686);let r,s=[],o=!1;class n{static init(e,t,i=0,r={}){if(o=r.mobile||r.isWebView,!t)return;if(!e.ads||(0,a.isEmpty)(e.ads))return;if(e.has_more)return;if(Array.isArray(e.ads)&&0===e.ads.length)return;const s=document.createElement("ins");s.classList.add("mrg-tag"),s.classList.add("article_adsblock"),r.mobile&&s.classList.add("article_adsblock_mobile"),s.style.display="block",s.style.textDecoration="none";let n="";if((0,a.isObject)(r.deviceInfo))for(let e in r.deviceInfo)r.deviceInfo.hasOwnProperty(e)&&(n+="&"+e+"="+r.deviceInfo[e]);e.ads.data["ad-query"]=e.ads.data["ad-query"].replace("%device_info%",n),e.ads.data["ad-query"]+=`&place=${i}`;for(let t in e.ads.data)e.ads.data.hasOwnProperty(t)&&s.setAttribute(`data-${t}`,String(e.ads.data[t]));t.appendChild(s),window.MRGtag||(window.MRGtag=[]);const c=r.isWebView?{iframeMode:!0}:{},d=e.ads.eventsHash;if(l(e,r,"requested",d),c.onNoAds=()=>{l(e,r,"no_ads",d)},c.onAdsLoaded=()=>{l(e,r,"ads_loaded",d)},c.onAdsClosed=()=>{l(e,r,"ads_closed",d)},c.onAdsSuccess=()=>{l(e,r,"ads_success",d)},c.onAdsClicked=()=>{l(e,r,"ads_clicked",d)},c.onScriptError=()=>{l(e,r,"script_error",d)},window.MRGtagOnAdsImpression=()=>{l(e,r,"ads_impression",d)},window.MRGtag.push(c),!window.mailRuSdsScriptLoaded){const t=document.createElement("script");t.setAttribute("src",e.ads.script),t.setAttribute("async","true"),document.head.appendChild(t),window.mailRuSdsScriptLoaded=!0}}static wasShown(){return false}}function l(e,t,i,n){s.push(`${i}/${e.owner_id}_${e.id}/${n}`),clearTimeout(r),r=setTimeout((()=>{const e=o?"article.php":"al_articles.php";ajax.post(e,{act:"ads_event",events:s.join(","),is_web_view:(0,a.intval)(t.isWebView)}),s=[]}),200)}},955962:(e,t,i)=>{function a(e,t,i,a){const r=t?"article.php":"al_articles.php";ajax.post(r,{act:"tts",article_owner_id:e.owner_id,article_id:e.id,hash:e.tts_hash,support_streaming:i?1:0},{onDone:e=>{a(e)}})}i.d(t,{loadArticle:()=>a})},620775:(e,t,i)=>{i.d(t,{default:()=>p});var a=i(637835),r=i(842856),s=i(390122),o=i(797749),n=i(487277),l=i(577686),c=i(86548),d=i(581378);const _={};let h,u;window._articleCarouselGlobalId=window._articleCarouselGlobalId||1;class p{getEl(){return this._els.view}getFooterEl(){return this._els.footer}getArticle(){return this._article}getScrollNode(){return this._options.getScrollNode?this._options.getScrollNode():document}_getScrollTop(){return this._options.getScrollTop?this._options.getScrollTop():window.scrollNode?window.scrollNode.scrollTop:window.document.documentElement.scrollTop}getTimeSpent(){return Math.round((Date.now()-this._openTime)/1e3)}changeCarouselPosition(e,t,i=!1,a=!0){const r=_[e];(0,l.isFunction)(r)&&r(0,!1,t,i,a)}deinit(){this._scrollEvent&&(this.getScrollNode().removeEventListener("scroll",this._scrollEvent),this._scrollEvent=!1),this._scrollStatEvent&&(this.getScrollNode().removeEventListener("scroll",this._scrollStatEvent),this._scrollStatEvent=!1),document.removeEventListener("click",this._handleClick),clearTimeout(this._readTO),this._options&&(this._options.trackCode=void 0,this._options.postId=void 0),window.removeEventListener("resize",this._handleResize)}_onViewScroll(){const e=scrollGetY(),t=window.innerHeight;this._els.view.querySelectorAll("figure").forEach((i=>{let a=(0,l.intval)(i.getAttribute("data-done"));if(a)return;const s=getH(i),o=getXY(i)[1],n=(0,l.intval)(i.getAttribute("data-type"));let c;switch(n){case r.ParagraphType.ObjectPhoto:c=-200;break;case r.ParagraphType.ObjectVideo:c=0;break;default:c=100}const d=o,_=o+s,h=e+c,u=e+t-c;let p;if(n===r.ParagraphType.ObjectVideo)p=_<=u&&h<=d||u<=_&&d<=h;else p=d<=u&&h<=_;a=this._onObjectView(p,n,i),a&&i.setAttribute("data-done",String(1))})),this._els.view.querySelectorAll("figure").forEach((i=>{const a=getH(i),r=getXY(i)[1],s=(0,l.intval)(i.getAttribute("data-type")),o=r,n=r+a,c=e,d=e+t;let _;if(o>d||c>n)_=!1;else{const e=Math.max(o,c);_=(Math.min(n,d)-e)/a>.7}this._onObjectPartialView(_,s,i)}))}_initObjects(){var e;this._initedObjects=this._initedObjects||{},null==(e=this._els.view)||e.querySelectorAll("._article_unmute_button").forEach(((e,t)=>{this._initedObjects[t]||(this._initedObjects[t]=!0,e.addEventListener("click",(()=>{let t=e.parentNode,i=t.querySelector("video");i.muted=!i.muted,t.classList.toggle("article_object_unmuted",!i.muted)})))})),this._els.view.querySelectorAll("figure").forEach(((e,t)=>{if(this._initedObjects[t])return;this._initedObjects[t]=!0;switch(parseInt(e.getAttribute("data-type"))){case r.ParagraphType.ObjectPhoto:{const t=(0,a.initPhotoCarousel)(e,{mobile:this._options.mobile,moderDeletePhoto:this._options.moderDeletePhoto,onClick:e=>{this.sendStats({type:e})}});if(this._initPhoto(e),t){const i=window._articleCarouselGlobalId++;e.setAttribute("data-carousel-id",i),_[i]=t}break}case r.ParagraphType.ObjectAudio:case r.ParagraphType.ObjectAudioPlaylist:e.querySelector(".article_figure_content").addEventListener("click",(()=>{this.sendStats({type:n.ArticleStatsEvents.clickOnAudio})}),!0);break;case r.ParagraphType.ObjectMarketItem:case r.ParagraphType.ObjectAliExpressProduct:break;case r.ParagraphType.ObjectGIF:case r.ParagraphType.ObjectVideo:if(this._options.mobile){const t=e.querySelector("video");t&&(t.addEventListener("play",(()=>{this.sendStats({type:n.ArticleStatsEvents.clickOnVideo})})),t.addEventListener("pause",(()=>{this.sendStats({type:n.ArticleStatsEvents.clickOnVideo})})))}else{const t=e.querySelector(".article_figure_content");t.addEventListener("click",(()=>{this.sendStats({type:n.ArticleStatsEvents.clickOnVideo})}),!0);const i=t.querySelector(".article_object_video");i&&e.getAttribute("data-autoplay")&&this._preloadVideo(i)}}})),this._els.view&&this._els.view.addEventListener("click",(e=>{const t=e.target;if(matchesSelector(t,'a[href^="/away"]')){const e=decodeURIComponent(unescape(t.href)).split(`${(0,c.getHostName)()}/away.php?to=`)[1];e&&this.sendStats({type:n.ArticleStatsEvents.clickOnExternalLink,domain:encodeURIComponent(this._getUrlDomain(e))})}}))}_initPhoto(e){e.querySelector(".article_figure_content").addEventListener("click",(()=>{const t=e.querySelector("[data-sizes]"),i=JSON.parse(t.getAttribute("data-sizes")),a=(0,l.intval)(e.getAttribute("data-photo-carousel-index"));this._options.onImageOpen&&this._options.onImageOpen.call(this,i,e,a),this.sendStats({type:n.ArticleStatsEvents.clickOnPhoto})}))}_initStats(){if(this._statsInited)return void(this._scrollStatEvent&&this._scrollStatEvent());this._statsInited=!0,this._openTime=Date.now();let e,t=-1,i=[];this._scrollStatEvent&&this.getScrollNode().removeEventListener("scroll",this._scrollStatEvent),clearTimeout(this._readTO);const a=this;function r(e){if(!i.length)return;const t=a._article,r=a._options;let s="";if(t.ref)s=t.ref;else if(window.cur&&(s=window.cur.module,"feed"===s&&cur.articlePrevLoc&&!r.mobile)){"search"===nav.fromStr(cur.articlePrevLoc).section&&(s="feed_search")}const o={act:"stats",scroll:i.join(","),spent:a.getTimeSpent(),hash:t.access_hash,article_owner_id:t.owner_id,article_id:t.id,is_web_view:r.isWebView?1:0,post_id:r.postId,is_widget:r.isWidget,is_delayed_scroll_4:(0,l.intval)(e),track_code:r.trackCode,ref:s};ajax.post(r.mobile?"article.php":"al_articles.php",o),t.mailru_stats_data&&i.forEach((e=>{(0,n.mailruStatsPixel)(`scroll_${e}`,t.mailru_stats_data)})),i=[]}this.getScrollNode().addEventListener("scroll",this._scrollStatEvent=function(){const s=a.getCurrentScrollRatio();if(s<0)return;let o=1;s>=.95?o=4:s>.66?o=3:s>.33&&(o=2),function(s){if(a._isReady&&(a._article.has_more&&(s=Math.min(s,1)),!(t>=s))){for(let e=t+1;e<=s;e++)i.push(e);if(t=s,clearTimeout(e),e=setTimeout(r,300),3==s&&a._article.ttr){const e=a._article.ttr-a.getTimeSpent();e>0&&(a._readTO=setTimeout((()=>{if(document.hidden)return;const e=a.getCurrentScrollRatio();if(e<0||e>1.3)return;const s=4==t;t=4,i=[t],r(s)}),1e3*e))}}}(o),4!=o||a._article.has_more||(a.getScrollNode().removeEventListener("scroll",a._scrollStatEvent),a._scrollStatEvent=!1)},{passive:!0}),this._scrollStatEvent&&this._scrollStatEvent()}_initGoogleAnalytics(){const e=this._options.googleAnalyticsId;if(e)if(window.dataLayer=window.dataLayer||[],window.gtag)window.gtag("config",e,{page_location:window.location.href});else{const t=document.createElement("script");t.setAttribute("src",`https://www.googletagmanager.com/gtag/js?id=${e}`),t.setAttribute("async","true"),document.head.appendChild(t),window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",e)}}_onObjectPartialView(e,t,i){const a=i.querySelector("[data-sizes]");if(!a)return;const s=Boolean(Number(a.getAttribute("data-should-disable-carousel-animation")));if(t==r.ParagraphType.ObjectPhoto&&!s){if(JSON.parse(a.getAttribute("data-sizes")).length>1){const t=i.getAttribute("data-carousel-id");e?u!=t&&(clearTimeout(h),h=setTimeout((()=>{const e=_[t];e&&e(1,!0)}),400),u=t):t==u&&(u=-1,clearTimeout(h))}}}_onObjectView(e,t,i){let a=!1;switch(t){case r.ParagraphType.ObjectPhoto:if(e){const e=i.querySelector("img"),t=getW(e)||this._options.width,r=i.querySelector("[data-sizes]"),s=JSON.parse(r.getAttribute("data-sizes")),o=i.querySelectorAll("img");s.forEach(((e,i)=>{const[a]=(0,n.getAppropriateImage)(s[i],t,!0);(0,n.preloadImage)(a,(()=>{const e=o[i];e.classList.remove("article_object_photo__image_blur"),e.src=a}))})),a=!0}break;case r.ParagraphType.ObjectGIF:if(!this._options.mobile){let t=i.querySelector("video");if(t)if(e){if(t.hasAttribute("autoplay")){const e=t.play();e&&e.catch((()=>{}))}}else t.pause();else a=!0}break;case r.ParagraphType.ObjectVideo:if(!this._article.isVideoAutoplayEnabled)return;if(this._options.mobile){if(i.getAttribute("data-autoplay")){let t=i.querySelector("vk-video-player");if(t)if(e){if(i.hasAttribute("data-autoplay")&&!i.hasAttribute("playing")){i.setAttribute("playing",!0);const e=document.querySelectorAll("vk-video-player");if(0===e.length)return;e.forEach((e=>{e!==t&&e.pause()})),t.play()}}else i.removeAttribute("playing")}}else if(i.getAttribute("data-autoplay")){const t=i.querySelector(".article_object_video_play"),a=i.querySelector("video");if(t)if(e){if(!a&&!t.hasAttribute("playing")){t.setAttribute("playing",!0);const e=i.querySelector(".article_object_video"),{video:a,accessByLinkHash:r}=e.dataset,s=this._getVideoParams(a,r);showInlineVideo(a,"",{autoplay:1,no_progress:1,cache:1,addParams:s},!1,e)}}else a||t.removeAttribute("playing")}break;case r.ParagraphType.ObjectTwitter:case r.ParagraphType.ObjectFacebook:case r.ParagraphType.ObjectInstagram:case r.ParagraphType.ObjectVK:case r.ParagraphType.ObjectTelegram:this.initEmbed(t,i),a=!0}return a}_getVideoParams(e,t){return{ad_block_id:null,ad_data:null,autoplay:1,autoplay_sound:0,from_autoplay:1,module:"article",list:null!=t?t:"",repeat:1,video:e}}_preloadVideo(e){const{video:t,accessByLinkHash:i}=e.dataset,a=this._getVideoParams(t,i);loadInlineVideo(a,null,!0)}initEmbed(e,t){switch(e){case r.ParagraphType.ObjectTwitter:const e=t.querySelector("[data-tweet-id]"),i=e.getAttribute("data-tweet-id");(0,o.loadScript)("https://platform.twitter.com/widgets.js",{onLoad:()=>{window.twttr.widgets.createTweet(i,e,{align:"center",lang:window.vk&&0==window.vk.lang?"ru":"en",dnt:!0})}});break;case r.ParagraphType.ObjectFacebook:const a=window.vk&&0==window.vk.lang?"ru_RU":"en_US";(0,o.loadScript)(`https://connect.facebook.net/${a}/all.js#xfbml=1&amp;version=v2.8`,{onLoad:()=>{window.FB.XFBML.parse()}});break;case r.ParagraphType.ObjectInstagram:(0,o.loadScript)("https://www.instagram.com/embed.js",{onLoad:()=>{window.instgrm.Embeds.process(),addEvent(window,"message",n.changeHeightInstagramEmbed)}});break;case r.ParagraphType.ObjectVK:const s=t.querySelector("[data-raw-id]"),l=s.getAttribute("data-raw-id"),c=s.getAttribute("data-index"),[d,_]=l.split(";");(0,o.loadScript)("/js/api/openapi.js",{onLoad:()=>{new Promise((e=>{ajax.post("dev.php",{act:"a_get_post_hash",post:`${d}_${_}`},{onDone:t=>{e(t)},onFail:()=>{e("")}})})).then(((e="")=>{var t,i;null==(i=window.VK)||null==(t=i.Widgets)||t.Post(`vk_post_${l}_${c}`,d,_,e,{from:this._options.isWebView?"article_webview":""})})).catch((()=>{}))}});break;case r.ParagraphType.ObjectTelegram:(0,o.loadScript)("https://telegram.org/js/telegram-widget.js?5",{})}}getCurrentScrollRatio(){const e=getH(this._els.view),t=getXY(this._els.view)[1]-getXY(this.getScrollNode().firstElementChild)[1];return(this._getScrollTop()+window.innerHeight-t)/e}getScreenVisibilityRatio(){const e=getH(this._els.view),t=getXY(this._els.view)[1]-getXY(this.getScrollNode().firstElementChild)[1],i=this._getScrollTop(),a=window.innerHeight,r=t,s=t+e,o=i,n=i+a;if(o>s||r>n)return 0;{const e=Math.max(r,o);return(Math.min(s,n)-e)/a}}update(){this._initObjects(),this._initStats(),this._options.onScroll&&this._options.onScroll.call(this,this.getCurrentScrollRatio())}ready(){if(this._isReady=!0,this._initObjects(),this._initStats(),this._initGoogleAnalytics(),this._initEventBusHandlers(),setTimeout((()=>{const e=(0,n.getUrlParam)("anchor");if(e){this._options.isWebView||this.scrollToAnchor(e);let t=this.getScrollNode();t===document&&(t=document.scrollingElement||window.scrollNode||document.body),t.click&&t.click(),t.focus()}}),0),!this._options.mobile&&window.AudioPlaylist&&this._article.audios_list&&this._article.audios_list.length>0){new AudioPlaylist(AudioPlaylist.TYPE_TEMP,this._article.owner_id,"article_"+this._article.id).mergeWith({list:this._article.audios_list})}this.getScrollNode().addEventListener("scroll",this._scrollEvent=()=>{this._onViewScroll(),this._options.onScroll&&this._options.onScroll.call(this,this.getCurrentScrollRatio())}),document.addEventListener("click",this._handleClick),setTimeout((()=>{"function"==typeof this._scrollEvent&&this._scrollEvent()}),this._options.objectsInitDelay||0),window.addEventListener("resize",this._handleResize)}scrollToAnchor(e,t){e=e||(0,n.getUrlParam)("anchor",t);const i=this._options;let a=this.getScrollNode();a===document&&(a=document.scrollingElement||window.scrollNode||document.body);e&&(()=>{const t=document.getElementById(e);if(!t)return;"scrollRestoration"in history&&(history.scrollRestoration="manual");const r=i.isWebView?0:25,s=t.parentNode.offsetTop-r;window.setTimeout((()=>{a.scrollTo?a.scrollTo(0,s):a.scrollTop=s}),10)})()}sendStats(e){const t=this._article,i=this._options,a={act:"stats",spent:this.getTimeSpent(),article_id:t.id,article_owner_id:t.owner_id,hash:t.access_hash,is_web_view:i.isWebView?1:0};Object.assign(a,e),ajax.post(i.mobile?"article.php":"al_articles.php",a)}_getUrlDomain(e){const t=document.createElement("a");return t.href=e,t.hostname}setGraphemes(e){this._graphemes=e||[]}getGrapheme(e){return this._graphemes.find((t=>e>=t.utterance_range[0]&&e<=t.utterance_range[1]))}hasGraphemes(){return!!this._graphemes.length}removeHighlight(){const e=document.querySelectorAll(".articleView__ttsHighlight");e.length&&e.forEach((e=>{const{parentNode:t}=e;e.firstChild&&t.insertBefore(e.firstChild,e),t.removeChild(e),t.normalize()}))}highlightProgress(e){this.removeHighlight();const t=this.getGrapheme(e);e>0&&t&&this._highlightText(t.orig_text_range[0],t.orig_text_range[1])}_getTextNodesIn(e){if(3===e.nodeType)return[e];const t=e.classList.contains("article__info_line"),i="FIGURE"===e.tagName;if(!e.childNodes.length||t||i)return[];const a=[];return e.childNodes.forEach((e=>{a.push(...this._getTextNodesIn(e))})),a}_highlightText(e,t){const i=this.getEl(),a=this._getTextNodesIn(i);let r=0,s=0;const o=e=>e.textContent.length;for(;r+o(a[s])-1<e;)r+=o(a[s]),s++;const n=a[s],l=o(n),c=document.createRange();let d=t-r;const _=d>l;d=_?l:d,c.setStart(n,e-r),c.setEnd(n,d);const h=document.createElement("span");h.className="articleView__ttsHighlight",h.appendChild(c.extractContents()),c.insertNode(h),_&&this._highlightText(r+l,t)}_updateTablePosition(e){const t=e.querySelector("table").getBoundingClientRect(),i=this._els.view.getBoundingClientRect(),a=t.width-i.width,r=i.left,s=this._options.mobile?0:140,o=Math.min(Math.abs(-s)+a/2,r);e.style.transform=`translateX(-${o}px)`}_setTableWidth(e){const t=e.querySelector("[data-table-container]");e.style.width=window.innerWidth-t.getBoundingClientRect().left+"px"}_initScroll(e){new s.Scroll(e)}_initEventBusHandlers(){(0,d.tq)().setStartupHandler("Article/update_table_position",(e=>{this._updateTablePosition(e.payload.target)})),(0,d.tq)().setStartupHandler("Article/init_scroll",(e=>{this._initScroll(e.payload.target)})),(0,d.tq)().setStartupHandler("Article/set_table_width",(e=>{this._setTableWidth(e.payload.target)}))}constructor(e,t,i){var a,r;this._handleClick=e=>{if(e.target.href)try{const t=new URL(e.target.href);this._article.url===t.pathname&&t.search.match(/\?|&anchor=/)&&(e.preventDefault(),this.scrollToAnchor(null,t.search),window.history.replaceState({},document.title,`${t.pathname}${t.search}`))}catch(e){console.error(e)}},this._handleResize=()=>{const e=this._els.view.querySelectorAll("[data-table-wrapper]");for(const t of e)this._updateTablePosition(t),t.articleScroll.update()},this._article=e,this._options=t,this._readTO=null,this._scrollStatEvent=!1,this._openTime=0,this._graphemes=[];const s=document.querySelector(`#article_view_${e.raw_id}`);this._els={view:s,footer:null==(r=s)||null==(a=r.closest(".article_layer__content"))?void 0:a.querySelector(".article_layer__content_footer")},window.cur&&cur.destroy&&cur.destroy.push((()=>{this.deinit()})),i&&this.ready()}}},637835:(e,t,i)=>{i.d(t,{initPhotoCarousel:()=>s});var a=i(577686),r=i(487277);function s(e,t){const i=e.querySelector("[data-sizes]"),s=JSON.parse(i.getAttribute("data-sizes"));(i.getAttribute("data-media-links")||"").split(",");if(s.length<=1||e.getAttribute("data-carousel-inited"))return;e.setAttribute("data-carousel-inited",1);const n="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;if(t.mobile&&n)return function(e,t,i={}){const s=t.querySelector(".article_photo_carousel__controls"),n=t.querySelector(".article_photo_carousel__counter"),l=n.getAttribute("data-counter-lang")||getLang("global_article_carousel_counter");let c=getSize(t.querySelector(".article_figure_content"));const d=t.querySelector(".article_photo_carousel_inner");t.querySelector(".article_photo_carousel__left").remove(),t.querySelector(".article_photo_carousel__right").remove();const _=i.onClick;let h,u,p,g=0,m=0,y=!1,v=0,w=0,f=!1,b=!1;s.addEventListener("touchstart",(e=>{u=e.touches[0].pageX,h=e.touches[0].pageY,d.classList.add("--no_trans"),y=!0,clearTimeout(p)}));let E,S=!1;s.addEventListener("touchmove",(t=>{if(!b&&(Math.abs(t.touches[0].pageY-h)>5||f))return void(f=!0);if(m=t.touches[0].pageX-u,Math.abs(m)<10&&!S)return;b||window.addEventListener("touchmove",E=e=>cancelEvent(e),{passive:!1}),b=!0,S=!0;let i=Math.min(e.length-1,Math.max(0,g+(m<0?1:-1)));const a=0===i&&0===g,r=i===e.length-1&&g===e.length-1;v=i;let s=-g*c[0];s+=a||r?.2*m:m,d.style.transform=`translateX(${s}px)`})),s.addEventListener("touchend",(()=>{S=!1,f=!1,b=!1,w=g,d.classList.remove("--no_trans"),E&&window.removeEventListener("touchmove",E);Math.abs(m)<50||(g=v),k(0,!1,v,!0)})),window.addEventListener("resize",A),window.cur&&window.cur.destroy&&window.cur.destroy.push((()=>{window.removeEventListener("resize",A)}));function A(){c=getSize(t.querySelector(".article_figure_content")),k(0,!1,g,!1,!1)}function k(i,s,h,u=!1,m=!0){if(!s||!y){if(y=!0,s)return d.style.transform="translateX(-50px)",void(p=setTimeout((()=>{d.style.transform="translateX(0px)"}),700));clearTimeout(p),g=void 0===g?Math.min(e.length-1,Math.max(0,g+i)):h,u&&(0,a.isFunction)(_)&&w!==g&&_(w<g?r.ArticleStatsEvents.clickOnCarouselNext:r.ArticleStatsEvents.clickOnCarouselPrev),t.setAttribute("data-photo-carousel-index",g),o(g,t),n.innerHTML=l.replace("{counter}",g+1).replace("{total}",e.length),m||d.classList.add("--no_trans"),d.style.transform=`translateX(-${g*c[0]}px)`,m||(d.offsetWidth,d.classList.remove("--no_trans"))}}return(e,t,i,a=!1,r=!0)=>{t||(v=i),w=g,k(e,t,i,a,r)}}(s,e,t);{const i=function(e,t,i,a){let s=0;const n=t.querySelector(".article_photo_carousel__controls"),l=t.querySelector(".article_photo_carousel__counter"),c=l.getAttribute("data-counter-lang")||getLang("global_article_carousel_counter"),d=getSize(t.querySelector(".article_figure_content")),_=t.querySelector(".article_photo_carousel_inner"),h=t.querySelector(".article_photo_carousel__left"),u=t.querySelector(".article_photo_carousel__right"),p=i.onClick;let g,m=!1;function y(i,a){if(!a||!m){if(m=!0,a)return _.style.transform="translateX(-50px)",void(g=setTimeout((()=>{_.style.transform="translateX(0px)"}),700));clearTimeout(g),s=Math.min(e.length-1,Math.max(0,s+i)),_.style.transform=`translateX(-${s*d[0]}px)`,l.innerHTML=c.replace("{counter}",s+1).replace("{total}",e.length),window.toggle(h,s>0),window.toggle(u,s<e.length-1),t.setAttribute("data-photo-carousel-index",s),o(s,t)}}return u.addEventListener("click",(e=>(y(1),p&&p(r.ArticleStatsEvents.clickOnCarouselNext),cancelEvent(e)))),h.addEventListener("click",(e=>(y(-1),p&&p(r.ArticleStatsEvents.clickOnCarouselPrev),cancelEvent(e)))),t.addEventListener("mousemove",(()=>{n.style.opacity=1})),t.addEventListener("mouseleave",(()=>{n.style.opacity=0})),y}(s,e,t);return window.data&&window.data(e,"changePhotoFunction",i),i}}function o(e,t){const i=t.querySelector("figcaption");let a=[];i&&(a=i.getAttribute("data-captions"),a&&(a=JSON.parse(a)),i.innerHTML=a[e]||"")}},481608:(e,t,i)=>{i.d(t,{ArticleLayer:()=>Se});var a=i(620775),r=i(944161),s=i(292218),o=i(314502),n=i(824189),l=i(214266),c=i(975969),d=i(124353),_=i(161276),h=i(487277),u=i(199682),p=i(665925),g=i(977041),m=i(714442),y=i(397067),v=i(764646),w=i(845179),f=i(538248),b=i(649638),E=i(912766),S=i(282770),A=i(993880),k=i(171795),T=i(542212),C=i(32991),L=i(783237),I=i(257065),O=i(168578),P=i(158879),M=i(815535),B=i(249590),x=i(161371),D=i(510600),N=i(135266),j=i(414126),R=i(584397),H=i(136633),U=i(673056),F=i(547142),V=i(640258),q=i(147419);const X="article_dark_mode",$="article_layer__content_wait_next";let z={},W={},Y="",G=!1,K={};const Q={},Z=[];let J;const ee=[],te=[];let ie,ae,re,se,oe,ne,le,ce,de,_e,he,ue=!1,pe=!1,ge=null,me=!1;function ye(e,t){(0,f.setStyle)(e,"transform",t?"":"translateY(100%)")}const ve="static",we="fix_shown",fe="fix_hidden",be="articles_scrolls",Ee=()=>`${be}_${window.vk.id}`;class Se{static openEditor(e,t,i,a){if(!Se.isStandalone())return Se.close(!0),setTimeout((()=>{nav.change({z:`article_edit${t}_${i}`,from_rev:!!a&&1})}),100),(0,c.cancelEvent)(e)}static isStandalone(){return!G}static setFaded(e){(0,f.toggleClass)(Q.layer,"article_layer__faded",e)}static updateLocation(){var e;let t=0,i=!1;ee.forEach((e=>{const a=e.getScreenVisibilityRatio();a>=t&&(i=e.getArticle(),t=a)})),i&&(null==(e=se)?void 0:e.raw_id)!==i.raw_id&&(se=i,this._setCurrentSummary(),history.replaceState({layer:!0},i.title,i.url),(0,f.lockDocumentTitle)(!1),(0,f.setDocumentTitle)(i.title),(0,f.lockDocumentTitle)(!0))}static _toggleArticleVisibility(e,t){const i=(0,f.ge)(`article_view_${e}`);t=(0,E.intval)(t),(0,E.intval)((0,f.domData)(i,"visible"))!=t&&((0,f.domData)(i,"visible",t),(0,f.setStyle)(i,"visibility",t?"":"hidden"))}static _initArticleView(e,t){var i,r;if(Se.isArticleWithoutData(e))return;let s=(0,f.gpeByClass)("article_layer__content",(0,f.ge)(`article_view_${e.raw_id}`));s||((0,f.removeClass)(Se._getLastContentEl(),$),s=(0,f.se)(t),ee.length>0&&((0,f.addClass)(s,"article_layer__next_prepared"),requestAnimationFrame((()=>{(0,f.removeClass)(s,"article_layer__next_prepared")}))),Q.viewsList.appendChild(s));const o=ee.length,n=new a.default(e,{getScrollNode:this.getScrollNode.bind(this),getScrollTop:this.getScrollTop.bind(this),isStandalone:Se.isStandalone(),objectsInitDelay:0==o?0:350,trackCode:null==(i=K)?void 0:i.trackCode,postId:null==(r=K)?void 0:r.postId,onScroll:t=>{if(!vk.widget){e.next_article_url&&t>.6&&Se._canShowMoreView()&&(Se.prepare(e.next_article_url,null,{ref:"scroll"}),(0,f.addClass)(Se._getLastContentEl(),$)),t>0&&t<1&&0==o&&Se._updateScrollSet(e);const i=n.getScreenVisibilityRatio();Se.updateLocation(),Se._toggleArticleVisibility(e.raw_id,i>0)}},onImageOpen:(e,t,i)=>{d.ArticleLayerPhotoOpen.open(e,i,t)}},{},!0);ee.push(n);const l=(0,f.geByClass1)("article_layer_ads_place",s);_.default.init(e,l,o,K),Se._checkBottomReach(),Se.moderActionsInit(e,s);const c=(0,f.geByClass1)("article_layer__mentions",s);let u;c&&c.addEventListener("click",(e=>{n.sendStats({type:h.ArticleStatsEvents.clickOnMentions})})),(0,j.partConfigEnabled)("longread_tts_web_player")&&this._updateFooterPlayButtons(),n.getEl().innerText.length>=500&&(u=this._initSummary(s,e.raw_id.split("_")[1],e.owner_id,n.sendStats.bind(n),0===te.length),u&&(te.push(u),se&&se.id!==u.getArticleId()&&u.disable(),ee.length>1&&!se&&u.disable())),K&&(K.trackCode=void 0,K.postId=void 0)}static _getLastContentEl(){const e=(0,f.geByClass)("article_layer__content");return e[e.length-1]}static _initBottomReached(){Z.push((()=>{Se._checkBottomReach()}))}static _checkBottomReach(){const e=(0,f.geByClass1)("article_layer__views"),t=parseInt(window.getComputedStyle(e).height,10);if(Se.getScrollTop()+window.innerHeight+200>=t){if(he)return;const e=ee[ee.length-1].getArticle();Se._canShowMoreView()&&e.next_article_url&&(Se.prepare(e.next_article_url),he=setTimeout((()=>{Se._loadNextArticle(e.next_article_url),he=!1}),300))}}static _canShowMoreView(){return ee.length<20}static closeImageFullSize(){return d.ArticleLayerPhotoOpen.close()}static _loadNextArticle(e){Se.prepare(e,((e,t)=>{Se._initArticleView(t,e)}))}static _restoreScroll(e){const t=Se._getSavedScroll(e.url);Se.setScrollTop(t)}static _deinitLayer(){document.removeEventListener("keydown",this.selectAllHotkey),Z.forEach((e=>{const t=Se.getScrollNode();t&&t.removeEventListener("scroll",e)})),Z.splice(0,Z.length),te.forEach((e=>{var t;null==(t=e)||t.removeEvents()})),clearTimeout(he),K&&(K.trackCode=void 0,K.postId=void 0),this.stopLoadingTts()}static _removeAllViews(){ee.forEach((e=>{e.deinit()})),ee.splice(0,ee.length),Q.viewsList&&(Q.viewsList.innerHTML="")}static selectAllHotkey(e){if((e.ctrlKey||e.metaKey)&&(65===e.keyCode||97===e.keyCode)&&se){e.preventDefault();const t=document.querySelector(`#article_view_${se.owner_id}_${se.id}`);if(t){const e=new Range;e.setStart(t,0),e.setEnd(t,t.childNodes.length),document.getSelection().removeAllRanges(),document.getSelection().addRange(e)}}}static show(e,t,i,a={}){if(Se.isArticleWithoutData(e))Se._initLayer();else{if(G=t,i&&((0,l.boxRefreshCoords)(boxLoader),(0,f.show)(boxLoader),(0,f.show)(boxLayerWrap)),Se._deinitLayer(),void 0!==a&&(K=a),layers.fullhide=!1,(0,E.isObject)(e)){const t=e;Se._initLayer(),Se._initArticleView(t),se=t,this._setCurrentSummary(),Se._restoreScroll(t),Se._initFooter(),Se._checkBackButton()}else Se.setFaded(!0),Se.prepare(e,((e,t,r)=>{Se.setFaded(!1),i&&((0,f.hide)(boxLoader),(0,f.hide)(boxLayerWrap)),Se._removeAllViews(),!0!==r.error?(Se._initLayer(),Se._initArticleView(t,e),se=t,this._setCurrentSummary(),Se._restoreScroll(t),Se._initFooter(),Se._checkBackButton(),t.title&&(re=document.title,(0,f.lockDocumentTitle)(!1),(0,f.setDocumentTitle)((0,E.replaceEntities)((0,E.stripHTML)(t.title))),(0,f.lockDocumentTitle)(!0)),a.ev&&(0,f.domClosest)("bookmarks_row_type_article",a.ev.target)&&(0,s.statlogsValueEvent)("bookmarks_product_analytics",{item_type:"article",item_owner_id:t.owner_id,item_id:t.id,time:(0,n.getServerTime)()}),(0,E.isFunction)(a.onShowDone)&&a.onShowDone()):(0,y.showFastBox)({title:v.getLang("global_error")},r.error_message||v.getLang("global_unknown_error"))}),{async:a.prepareAsync});this.isStandalone()&&(0,w.updateCounters)(location.href,document.referrer)}}static isShown(){return!!Q.layer}static isArticleWithoutData(e){return(0,E.isArray)(e)&&0===e.length}static back(){const e=ee.length&&ee[0].getArticle();if(Se.isStandalone())if(e&&e.is_blog){if(window.history&&window.history.length>1)return window.history.back(),!0;location.href=e.owner_href}else location.href="/feed";else this._deinitLayer(),history.go(-1)}static close(e){if(!Se.isShown())return!0;const t=ee.length&&ee[0].getArticle(),i=t?t.owner_href:"",a=se?se.back_url:"";if(Se.isStandalone())return t.is_blog&&window.history&&window.history.length>1?(window.history.back(),!0):(window.location.href=a||i||"/feed",!0);if(window.onbeforeunload=!1,vk.widget)window.Rpc&&window.Rpc.callMethod("destroy");else{if(e){Se._deinitLayer();let e=-1;window.cur&&cur.articleSequence&&(e=-cur.articleSequence),history.go(e),cur.articleSequence=0}else Se._removeAllViews(),(0,f.removeClass)(document.body,"body_article_layer"),re&&((0,f.lockDocumentTitle)(!1),(0,f.setDocumentTitle)(re)),(0,f.re)(Q.layer),Q.layer=!1;ae&&ae.destroy(),J&&window.removeEventListener("beforeunload",J),J=!1}}static getScrollNode(){return Se.isStandalone()?window:Q.layer}static getScrollTop(){return Se.isStandalone()?(0,o.scrollGetY)():Q.layer.scrollTop}static setScrollTop(e){(Se.isStandalone()?window.scrollNode:Q.layer).scrollTop=e}static _initLayer(){var e;if(Q.layer)return;if(document.addEventListener("keydown",this.selectAllHotkey),Q.layer=(0,f.geByClass1)("_article_layer"),!Q.layer){if(!Y)throw new Error("Article layer html not found");Q.layer=(0,f.se)(Y),document.body.appendChild(Q.layer),(0,f.addClass)(document.body,"body_article_layer"),(0,f.setStyle)(Q.layer,{opacity:1})}de=(0,b.getAudioPlayer)(),this.ttsPlayerEl=(0,f.geByClass1)("article_layer__tts_player"),_e=de.getVolume();const t=document.querySelector(".article_layer__tts__volume_slider");ce=new D.default(t,{value:de.getVolume(),size:1,hintClass:"audio_player_hint",log:!0,formatHint:e=>Math.round(100*e)+"%",onChange:e=>{de.setVolume(e),_e=e}}),ue||(de.on(this,x.events.VOLUME,((e,t)=>{U.ArticleTts.isAnyArticleInPlayer()&&this._isPlayerInDOM()&&ce&&(ce.setValue(t,!0),this._updateVolumeIcon())})),de.subscribe(x.events.PLAY,(()=>{U.ArticleTts.isAnyArticleInPlayer()&&this._isPlayerInDOM()&&(this._toggleTtsPlayer(U.ArticleTts.isAnyArticleInPlayer()),this._updatePlayButton(),this._updateFooterPlayButtons(),this._updatePlayerTitle())})),de.subscribe(x.events.PAUSE,(()=>{U.ArticleTts.isAnyArticleInPlayer()&&this._isPlayerInDOM()&&(this._toggleTtsPlayer(U.ArticleTts.isAnyArticleInPlayer()),this._updatePlayButton(),this._updateFooterPlayButtons())})),ue=!0),this._toggleTtsPlayer(U.ArticleTts.isAnyArticleInPlayer()),U.ArticleTts.isAnyArticleInPlayer()&&(this._updatePlayerTitle(),this._updatePlayButton(),this._updatePlaybackSpeed()),Q.up=(0,f.geByClass1)("article_layer__up",Q.layer),Q.darkBtn=(0,f.geByClass1)("article_layer__dark",Q.layer),Q.closeBtn=(0,f.geByClass1)("article_layer__close",Q.layer),Q.placeholderCloseBtn=(0,f.geByClass1)("article_layer_placeholder__back_button",Q.layer),Q.back=(0,f.geByClass1)("article_layer__back",Q.layer),Q.viewsList=(0,f.geByClass1)("article_layer__views",Q.layer),oe&&Q.darkBtn.removeEventListener("click",oe),Q.darkBtn.addEventListener("click",oe=()=>{if(Se._toggleDarkMode(),ee.length){ee[ee.length-1].sendStats({type:me?h.ArticleStatsEvents.nightModeOn:h.ArticleStatsEvents.nightModeOff})}}),ne&&Q.closeBtn.removeEventListener("click",ne),Q.closeBtn.addEventListener("click",ne=()=>{if(Se.close(!0),ee.length){ee[ee.length-1].sendStats({type:h.ArticleStatsEvents.close})}}),vk.widget&&(0,f.re)(Q.up),Q.placeholderCloseBtn&&(le&&Q.placeholderCloseBtn.removeEventListener("click",le),Q.placeholderCloseBtn.addEventListener("click",le=Se.close.bind(null,!0))),Q.scrollNode=vk.widget||!Se.isStandalone()?Q.layer:document.scrollingElement,Se.isStandalone()||(J&&window.removeEventListener("beforeunload",J),window.addEventListener("beforeunload",J=()=>{window.scrollTo(0,0)})),Se.getScrollNode().addEventListener("scroll",(e=>{Z.forEach((t=>{t(e)}))})),Z.push((()=>{(0,f.toggleClass)(Q.up,"article_layer__up--shown",Se.getScrollTop()>0)}));const i=(0,f.geByClass1)("article_layer__inner",Q.layer);ie=(0,f.se)(`<div class='article_anchor_tooltip_content'>${v.getLang("pages_article_anchor_copy")}</div>`),ae=new ElementTooltip(Q.layer,{content:ie,autoShow:!1,customShow:!0,forceSide:"top",cls:"article_anchor_tooltip",noBorder:!0,onHide:()=>{ie.innerHTML=v.getLang("pages_article_anchor_copy")}}),Q.layer.addEventListener("mousemove",(e=>{(0,f.toggleClass)(Q.layer,"article_layer__hover_left",i.contains(e.target)&&e.pageX<115);if(!!e.target.closest(".article_anchor_button")&&ae&&!ae.isShown()){const t=e.target.parentNode,{top:i,left:a}=t.getBoundingClientRect();ae.show();const r=ae._ttel.getBoundingClientRect(),s=Se.getScrollTop();(0,f.setStyle)(ae._ttel,{top:i+s-r.height-5,left:a-r.width/2+13}),t.addEventListener("mouseleave",(()=>{ae.hide()}))}})),null==(e=Q.up)||e.addEventListener("click",(()=>{Q.up.classList.contains("article_layer__up--shown")?Se.setScrollTop(0):Q.back&&Se.back()})),Q.layer.addEventListener("click",(e=>{let t=e.target.closest(".article_anchor_button");if(t){if(t.id){const e=(0,f.gpeByClass)("article_view",t),i=(0,f.domData)(e,"article-url"),a=`${location.protocol}//${location.host}${i}`;(0,f.domClosestByTag)("h1",t)?(0,p.copyToClipboard)(a):(0,p.copyToClipboard)(`${a}?anchor=${t.id}`),ie.innerHTML=v.getLang("pages_article_anchor_copied")}(0,f.hasClass)(Q.layer,"article_layer__hover_right")&&Se.close(!0)}})),Se._initBottomReached()}static _initFooter(){if(!vk.id)return;let e,t,i=!1;function a(t,i,a,r){const s=(0,f.domData)(t,"state")||ve,o=(0,f.geByClass1)("article_layer__tts_player");s!=i&&(e||(s==ve?i==we?(ye(t,!1),a?((0,f.addClass)(t,"article_layer__content_footer--fix"),(0,f.addClass)(o,"article_layer__tts_player__over_footer"),(0,f.removeClass)(t,"article_layer__content_footer__player_fix"),ye(t,!0)):e=setTimeout((()=>{(0,f.addClass)(t,"article_layer__content_footer--fix"),(0,f.addClass)(o,"article_layer__tts_player__over_footer"),(0,f.removeClass)(t,"article_layer__content_footer__player_fix"),e=setTimeout((()=>{ye(t,!0),e=!1}))}))):i==fe&&((0,f.removeClass)(t,"article_layer__content_footer__player_fix"),ye(t,!1),e=setTimeout((()=>{(0,f.addClass)(t,"article_layer__content_footer--fix"),(0,f.removeClass)(o,"article_layer__tts_player__over_footer"),e=!1}))):s==we?i==fe?(ye(t,!1),(0,f.removeClass)(o,"article_layer__tts_player__over_footer")):i==ve&&(ye(t,!1),e=setTimeout((()=>{(0,f.removeClass)(t,"article_layer__content_footer--fix"),(0,f.removeClass)(o,"article_layer__tts_player__over_footer"),r&&pe&&(0,f.addClass)(t,"article_layer__content_footer__player_fix"),ye(t,!0),e=!1}),350)):s==fe&&(i==we?(ye(t,!0),(0,f.addClass)(o,"article_layer__tts_player__over_footer")):i==ve&&((0,f.removeClass)(t,"article_layer__content_footer--fix"),(0,f.removeClass)(o,"article_layer__tts_player__over_footer"),r&&pe&&(0,f.addClass)(t,"article_layer__content_footer__player_fix"),ye(t,!0))),(0,f.domData)(t,"state",i)))}let r,s=Se.getScrollTop(),o=!0;Z.push(r=()=>{se||(se=ee[0].getArticle(),this._setCurrentSummary());const e=(0,f.ge)("article_view_"+se.raw_id),r=(0,f.gpeByClass)("article_layer__content",e),n=(0,f.geByClass1)("article_layer__content_footer",r);if(!r||!n)return;const l=Se.getScrollTop(),c=!se.next_article_url,d=l<=s;s=l,i!=n&&(t=r.offsetTop+n.offsetTop,a(i,ve,!1,c)),i=n;const _=l+window.innerHeight<t-100;a(n,_?!_||d?we:fe:ve,o,c),o=!1}),r()}static onShareBtnClick(e,t){(0,y.showBox)("like.php",{act:"publish_box",object:t},{stat:[window.jsc("web/page.js"),"page.css",window.jsc("web/wide_dd.js"),"wide_dd.css",window.jsc("web/sharebox.js")],onFail:function(e){return(0,y.showFastBox)(v.getLang("global_error"),e||v.getLang("global_error")),!0}})}static onFaveBlogBtnClick(e,t,i){const a=(0,b.getIconBookmarked)(t);t.dataset.state=String(a?0:1),(0,b.sendBookmarkLink)(a,i,(0,f.domData)(t,"link-url"),(0,f.domData)(t,"link-img"),(0,f.domData)(t,"link-title"),(0,f.domData)(t,"track-code"))}static onFaveBtnClick(e,t,i,a,r,s){const o=(0,f.gpeByClass)("article_layer__content",(0,f.domQuery1)(`[data-article-url="${r}"]`));window.stManager.add(["notifier.css",window.jsc("web/notifier.js")]);let n=!1;(0,E.each)((0,f.geByClass)("article_layer__content_footer_button_bookmark",o),((e,t)=>{n=(0,f.toggleClass)(t,"activated")})),(0,b.bookmarkArticle)(null,null,t,i,"article",s,!n)}static onReportBtnClick(e,t){(0,S.showReportForm)("article",e,t,(()=>{const e=document.querySelector(".article_layer_menu_report__button");null!==e?(e.innerHTML=v.getLang("global_report_sent"),e.onclick=null):(0,r.debugLog)("Unable to change report button, because no report button is found")}))}static _getSavedScrollMap(){return window.ls.get(Ee())||window.ls.get(be)||{}}static _getSavedScroll(e){let t=window.ls.get("articles_scrolls")||{};return(0,j.partConfigEnabled)("content_multiaccount_web_feature")&&(t=Se._getSavedScrollMap()),t[e]||0}static _updateScrollSet(e){const t=Se.getScrollTop();let i=ls.get("articles_scrolls")||{};(0,j.partConfigEnabled)("content_multiaccount_web_feature")&&(i=Se._getSavedScrollMap()),Object.keys(i).length>100&&(i={}),i[e.url]=t,(0,j.partConfigEnabled)("content_multiaccount_web_feature")?ls.set(Ee(),i):ls.set("articles_scrolls",i)}static getDarkMode(){return!!(0,E.intval)(localStorage.getItem(X))}static _toggleDarkMode(e,t){var i;me=(0,f.toggleClass)(Q.layer,"article_dark",t),H.colorScheme.applyScheme(Q.layer,me?H.ColorSchemeName.WebDark:H.ColorSchemeName.WebLight);if(null==(i=document.querySelector(".article_theme"))||i.setAttribute("theme",me?"dark":"light"),Se.isStandalone()&&(0,f.toggleClass)(document.body,"article_dark",me),t?(0,f.toggleClass)(Q.layerSubscribeBtn,"black",me):((0,f.addClass)(Q.layerSubscribeBtn,"article_layer_btn_transition"),setTimeout((()=>{(0,f.removeClass)(Q.layerSubscribeBtn,"article_layer_btn_transition")}),450),(0,f.toggleClassDelayed)(Q.layerSubscribeBtn,"black",me)),void 0===t&&vk.id){const e=ee[0]?ee[0].getArticle().dark_mode_hash:"";ajax.post("al_articles.php",{act:"set_dark_mode",is_on:(0,E.intval)(me),hash:e})}localStorage.setItem(X,(0,E.intval)(me))}static _initSummary(e,t,i,a,r=!1){const s=e.querySelector(".article_summary_wrapper"),o=e.querySelector(".article_summary_btn");return!(!s||!o)&&new q.Summary(s,o,e,a,r,t,i)}static _setCurrentSummary(){te.forEach((e=>{e.getArticleId().toString()===se.id.toString()?e.activate():e.disable()}))}static clearAllPrepared(){z={}}static clearPrepared(e){e=e.replace(/^\//,""),delete z[e]}static prepare(e,t,i={}){if(t||(t=()=>{}),(0,E.isObject)(e)&&(e=e.url),e=e.replace(/^\//,""),(0,E.isObject)(z[e])){const a=()=>t(...z[e].result);return i.async?void setTimeout(a,0):a()}if(z[e]=z[e]||[],z[e].push(t),z[e].length>1)return;const a=(0,E.inArray)(cur.module,["groups","profile","public"])?cur.oid:"";let r="",s="";i.ref&&(s=i.ref),r=cur.authorPage?"author_page_"+cur.authorPage.sortType:cur.module,ajax.post("al_articles.php",{act:"view",url:e,layer:1,wall_owner_id:a,context:r,ref:s},{onDone:(t,i,a,r)=>{if(!z[e])return;const s=z[e];Y=t,z[e]={result:[i,a,r]},s.forEach((t=>t.apply(null,z[e].result)))},onFail:()=>((0,E.isFunction)(i.onFailCallBack)&&i.onFailCallBack(),!0)}),window.cur&&cur.destroy.push((()=>{Se.clearPrepared()}))}static clearPrepared(){z={}}static onSubscribeBtnClick(e){if(R.FlatButton.isLocked(e))return;const t=JSON.parse(e.dataset.data),i=F.Ranges.isUserIdTransitional(t.oid);let a=R.FlatButton.getAppearance(e)===R.FlatButtonAppearance.SECONDARY,r={showProgress:()=>R.FlatButton.lock(e),hideProgress:()=>R.FlatButton.unlock(e),onDone:function(){W[t.oid]=!a,a?(R.FlatButton.setAppearance(e,R.FlatButtonAppearance.PRIMARY),R.FlatButton.setLabel(e,e.getAttribute("data-subscribe_label")),R.FlatButton.setBefore(e,(0,A.getIcon16Add)().icon)):(R.FlatButton.setAppearance(e,R.FlatButtonAppearance.SECONDARY),R.FlatButton.setLabel(e,e.getAttribute("data-unsubscribe_label")),R.FlatButton.setBefore(e,(0,k.getIcon16Done)().icon),i||(0,V.trackTmrGroupsJoin)()),t.confirm&&a&&(0,f.hide)(e)}};if(i)ajax.post("al_friends.php",{act:a?"remove":"add",mid:t.oid,hash:t.hash},r);else{let e=ajax.post.pbind("al_groups.php",{act:a?"a_leave":"a_enter",gid:-t.oid,hash:t.hash},r);if(t.confirm&&a){let i=(0,y.showFastBox)(t.confirm.title,t.confirm.text,t.confirm.btn,(function(){i.hide(),e()}),v.getLang("global_cancel"))}else e()}}static moderActionsInit(e,t){const i=e.moder_actions_hash,a=(0,f.domQuery1)("#article_moder_rev_sel",t);a&&a.addEventListener("change",(e=>{nav.change({rev:e.target.value}),location.reload()}));const r=(0,f.domQuery1)("#article_moder__rev_restore",t);r&&r.addEventListener("click",(()=>{a.value&&ajax.post("al_articles.php",{act:"moder_restore_article_rev",hash:i,article_owner_id:e.owner_id,article_id:e.id,revision:(0,E.intval)(a.value)},{showProgress:m.lockButton.pbind(r),onDone:()=>{nav.change({rev:!1}),location.reload()}})}));const s=(0,f.domQuery1)("#article_moder__ban_btn",t);if(s){const t=(0,E.intval)(s.getAttribute("data-banned"))?0:1;s.addEventListener("click",(()=>{const a={act:"moder_ban_article",hash:i,article_owner_id:e.owner_id,article_id:e.id,do_ban:(0,E.intval)(t)};(0,g.isClaimContent)()&&(a.claim=window.nav.objLoc.claim),ajax.post("al_articles.php",a,{showProgress:m.lockButton.pbind(s),onDone:()=>{location.reload()}})}))}}static onPlaybackSpeedTtsClick(){de.podcastChangePlaybackRate(),this._updatePlaybackSpeed()}static _findArticleViewFromPlayer(){return ee.find((e=>U.ArticleTts.isArticleInPlayer(e.getArticle())))}static _isArticleTtsInPlayer(){return N.AudioUtils.isArticleTts(de.getCurrentAudio())}static _isPlayerInDOM(){return!!document.querySelector(".article_layer__tts_player")}static _updatePlaybackSpeed(){this._isPlayerInDOM()&&(document.querySelector(".article_layer__tts__playback_rate").innerHTML=`${AudioPlayer.podcastGetPlaybackRate()}x`)}static _updatePlayButton(){if(!this._isPlayerInDOM())return;const e=U.ArticleTts.isAnyArticleInPlayer()&&de.isPlaying();document.querySelector(".article_layer__tts__play").innerHTML=e?(0,T.getIcon28Pause)().icon:(0,C.getIcon28Play)().icon}static _updateFooterPlayButtons(){ee.forEach((e=>{var t;const i=null==(t=e.getFooterEl())?void 0:t.querySelector(".article_layer__content_footer_button_play_tts");if(i){i.innerHTML=this._getFooterTtsButtonIcon(e.getArticle());const t="article_layer__content_footer_button_play_tts__loader";U.ArticleTts.isLoadingArticle(e.getArticle())?(0,f.addClass)(i,t):(0,f.removeClass)(i,t)}}))}static _updatePlayerTitle(){if(!this._isPlayerInDOM())return;const e=N.AudioUtils.audioTupleToAudioObject(de.getCurrentAudio());document.querySelector(".article_layer__tts__title").innerText=e.title,document.querySelector(".article_layer__tts__performer").innerText=e.performer}static _updateVolumeIcon(){if(!this._isPlayerInDOM())return;const e=de.getVolume()>0?(0,L.getIcon24VolumeOutline)().icon:(0,I.getIcon24MuteOutline)().icon,t=v.getLang("audio_volume_on"),i=v.getLang("audio_volume_off"),a=de.getVolume()>0?t:i,r=document.querySelector(".article_layer__tts__volume");r.innerHTML=e,r.ariaLabel=a}static _getIconBackground(e){return`\n        <div class="article_layer__content_footer_icon_box">\n          <img class="article_layer__content_footer_icon_bg" src="${B}" alt="">\n          ${e}\n        </div>\n      `}static _getFooterTtsButtonIcon(e){return U.ArticleTts.isLoadingArticle(e)?(0,O.getIcon16Spinner)().icon:de.isPlaying()&&U.ArticleTts.isArticleInPlayer(e)?this._getIconBackground((0,P.getIcon28StopMarusiaForeground)().icon):this._getIconBackground((0,M.getIcon28PlayMarusiaForeground)().icon)}static onPlayTtsClick(){de.isPlaying()?de.pause():(de.play(),this._toggleTtsPlayer(!0))}static onFooterPlayTtsClick(e,t){if(U.ArticleTts.isArticleInPlayer({owner_id:e,id:t}))return void this.onPlayTtsClick();const i=ee.find((i=>i.getArticle().id===t&&i.getArticle().owner_id===e));this._requestTts(i,!0)}static onCloseTtsClick(){U.ArticleTts.sendStats(u.ArticleTtsActionType.CLOSE),de.pause(),de.deleteCurrentPlaylist(),this._toggleTtsPlayer(!1),this._updatePlayButton(),this._updateFooterPlayButtons()}static onVolumeToggleClick(){de.getVolume()>0?de.setVolume(0):de.setVolume(_e)}static stopLoadingTts(){ge&&(ge(),ge=null)}static _onTtsResponse(e,t,i){if(this.stopLoadingTts(),e.error)return this._updateFooterPlayButtons(),void(0,g.showErrorBox)(v.getLang("global_unexpected_error_try_later"),3e3);e.queue?(Notifier.addKey(e.queue,((a,r)=>{r.events.find((e=>"marusyatts"===e.entity_type&&e.data.article_raw_id===t.getArticle().raw_id))&&(delete curNotifier.addQueues[e.queue.key],ge=null,(0,f.ge)(`article_view_${t.getArticle().raw_id}`)&&this._requestTts(t,i))})),ge=()=>delete curNotifier.addQueues[e.queue.key]):(ajax.post("al_marusia.php",{act:"send_longread_stats",article_raw_id:t.getArticle().raw_id}),i&&U.ArticleTts.play(t.getArticle().id,t.getArticle().owner_id,e.meta,Se.onArticleTtsExpire))}static onArticleTtsExpire(e){Se.onFooterPlayTtsClick(e.articleOwnerId,e.articleId)}static _requestTts(e,t){de._impl.preparePlay();U.ArticleTts.load(e.getArticle(),!1,!0,(i=>this._onTtsResponse(i,e,t))),this._updateFooterPlayButtons()}static _toggleTtsPlayer(e){ye(this.ttsPlayerEl,e),ee.forEach((t=>{const i=t.getFooterEl();e||(0,f.removeClass)(i,"article_layer__content_footer__player_fix");const a=(0,f.domData)(i,"state")||ve,r=t.getArticle()===se,s=a===ve,o=!t.getArticle().next_article_url;e&&r&&s&&o&&(0,f.addClass)(i,"article_layer__content_footer__player_fix")})),pe=e}static _checkBackButton(){if(this.isStandalone()){const e=ee.length&&ee[0].getArticle();e&&e.is_blog||(Q.back.remove(),delete Q.back)}Q.back&&Q.back.classList.add("article_layer__back--show")}}},673056:(e,t,i)=>{i.d(t,{ArticleTts:()=>_});var a=i(199682),r=i(698143),s=i(239051),o=i(161371),n=i(643907),l=i(604742),c=i(660210),d=i(955962);class _{static load(e,t,i,a){this.loadingArticleRawId=e.raw_id,(0,d.loadArticle)(e,t,i,(e=>{this.loadingArticleRawId=null,a(e)}))}static getAudio(e,t,i){const a=[],s=JSON.stringify({articleTts:!0,articleId:e,articleOwnerId:t,externalStream:!0});return a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]=`${t}${e}`,a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]=t,a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_URL]=i.url,a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TITLE]=i.title,a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_PERFORMER]=i.artist,a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_DURATION]=i.duration,a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_AUTHOR_LINK]="",a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_LYRICS]=0,a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]=0,a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_CONTEXT]="",a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=s,a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_HASHES]="",a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_COVER_URL]="",a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ADS]={},a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_SUBTITLE]="",a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_MAIN_ARTISTS]="",a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FEAT_ARTISTS]="",a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM]=!1,a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TRACK_CODE]="",a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=0,a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_PART]=0,a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_ACCESS_KEY]="",a[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CHART_INFO_INDEX]=!1,a}static play(e,t,i,r){this.onArticleTtsExpire=r,this.statsHandlersInitialized||(this._audioPlayer().subscribe(o.AudioPlayerEventType.PLAY,(()=>{if(this.isAnyArticleInPlayer()){const e=this._audioPlayer().getCurrentProgress()>0?a.ArticleTtsActionType.CONTINUE:a.ArticleTtsActionType.START;this.sendStats(e)}})),this._audioPlayer().subscribe(o.AudioPlayerEventType.PAUSE,(()=>{this.isAnyArticleInPlayer()&&this.sendStats(a.ArticleTtsActionType.PAUSE)})),this._audioPlayer().subscribe(o.AudioPlayerEventType.ENDED,(()=>{if(this.isAnyArticleInPlayer()){var e,t,i;let r=this._audioPlayer();if((null==(e=r._impl)?void 0:e._hlsError)||(null==(i=r._impl)||null==(t=i._currentAudioEl)?void 0:t.error)){r._impl&&(r._impl._hlsError=void 0);const e=(0,c.getAudioExtra)(r.getCurrentAudio());r.deleteCurrentPlaylist(),_.retryCount<3&&(_.retryCount+=1,setTimeout((()=>{var t;null==(t=this.onArticleTtsExpire)||t.call(this,e)}),_.RETRY_TIMEOUT))}this.sendStats(a.ArticleTtsActionType.P100)}})),this.statsHandlersInitialized=!0);const s=this.getAudio(e,t,i),n=this._audioPlayer().getPlaylist(l.AudioPlaylist.TYPE_ARTICLE_TTS,t,e);n.mergeWith({list:[s]}),this._audioPlayer().play(s,n)}static _audioPlayer(){return window.getAudioPlayer()}static _audioExtra(){const e=this._audioPlayer().getCurrentAudio();var t;return null!=(t=(0,c.getAudioExtra)(e))?t:{}}static isLoadingArticle(e){return this.loadingArticleRawId===e.raw_id}static isArticleInPlayer(e){return e.owner_id===this._audioExtra().articleOwnerId&&e.id===this._audioExtra().articleId}static isAnyArticleInPlayer(){return(0,s.isArticleTts)(this._audioPlayer().getCurrentAudio())}static sendStats(e){var t;const{articleId:i,articleOwnerId:r}=this._audioExtra();var s;a.articleTtsActionStatController.logEvent({action:e,nav_screen:"article_read",article_id:i,owner_id:r,audio_length:null!=(s=null==(t=(0,n.audioTupleToAudioObject)(this._audioPlayer().getCurrentAudio()))?void 0:t.duration)?s:0,speed:Math.round(100*AudioPlayer.podcastGetPlaybackRate()),volume:Math.round(100*this._audioPlayer().getVolume())})}}_.statsHandlersInitialized=!1,_.retryCount=0,_.RETRY_TIMEOUT=1e3},510600:(e,t,i)=>{i.d(t,{default:()=>c});var a=i(538248),r=i(764646),s=i(912766),o=i(975969),n=i(585878);function l(e,t){if(this.constructor!=l)throw new Error("Slider was called without 'new' operator");if(!e)throw new Error("No element was provided for Slider");e=(0,a.ge)(e),this.options=t||{size:1},this.options.backValue=this.options.backValue||0;const i=100*this.options.backValue,r=`<div class="slider_slide"><div class="slider_loading_bar" style="opacity: 0; display: none;"></div> ${this.options.withBackLine?'<div class="slider_back" style="width:'+i+'%"></div>':""} <div class="slider_amount"></div> <div class="slider_handler"></div> </div>`;this._el=(0,a.ce)("div",{innerHTML:r,className:"slider",id:e.getAttribute("id")||""});const c=e.classList||[],d=this;for(let e=0,t=c.length;e<t;e++)(0,a.addClass)(this._el,c[e]);(0,s.each)(this._el.attributes,(function(e,t){"id"==t.name&&"class"==t.name||d._el.setAttribute(t.name,t.value)})),e.parentNode.replaceChild(this._el,e),(0,a.data)(this._el,"slider",this),this._amountEl=(0,a.geByClass1)("slider_amount",this._el),this._handlerEl=(0,a.geByClass1)("slider_handler",this._el),this._slideEl=(0,a.geByClass1)("slider_slide",this._el),this._backEl=(0,a.geByClass1)("slider_back",this._el),this._progressEl=(0,a.geByClass1)("slider_loading_bar",this._el),this.options.color&&((0,a.setStyle)(this._amountEl,{backgroundColor:this.options.color}),(0,a.setStyle)(this._handlerEl,{backgroundColor:this.options.color})),this.options.handlerColor&&(0,a.setStyle)(this._handlerEl,{backgroundColor:this.options.handlerColor}),this.options.backColor&&(0,a.setStyle)(this._slideEl,{backgroundColor:this.options.backColor}),(0,a.addClass)(this._el,"slider_size_"+this.options.size),this.options.debounce&&(this._onValueChangeDebounced=(0,n.debounce)(this._onValueChange,this.options.debounce)),t.formatHint&&((0,o.addEvent)(this._el,"mousemove",this._ev_onMouseOver=this._onMouseOver.bind(this)),(0,o.addEvent)(this._el,"mouseleave",this._ev_onMouseLeave=this._onMouseLeave.bind(this))),(0,o.addEvent)(this._el,"mousedown",this._ev_onMouseDown=this._onMouseDown.bind(this)),this.setValue(this.options.value||0,!this.options.fireChangeEventOnInit,!1),this.setBackValue(this.options.backValue)}l.prototype.toggleAdState=function(e){this._adState=!!e,(0,a.toggleClass)(this._el,"slider_ad_mode",!!e)},l.prototype.toggleAdMarker=function(e){e=!!e;let t=(0,a.geByClass1)("slider_ad_marker",this._el);if(e){if(!t){const e="onmouseover=\"showTooltip(this, {text: '"+r.getLang("global_audio_ad")+"', black: 1, shift: [16, 9, 10]})\"";t=(0,a.se)('<div class="slider_ad_marker_wrap" '+e+'><div class="slider_ad_marker"></div></div>'),(0,a.domPN)(this._slideEl).insertBefore(t,this._slideEl),delete this._width,(0,a.addClass)(this._el,"slider_ad_marker_shown")}}else(0,a.re)(t),delete this._width,(0,a.removeClass)(this._el,"slider_ad_marker_shown")},l.prototype.showAdMarker=function(e){const t=(0,a.se)('<div class="slider_ad_marker"></div>');(0,a.domPN)(this._slideEl).insertBefore(t,this._slideEl),delete this._width,(0,a.addClass)(this._el,"slider_ad_marker_shown")},l.prototype.isAdMode=function(){return(0,a.hasClass)(this._el,"slider_ad_mode")},l.prototype.setBlocked=function(e){this.blocked=e,(0,a.toggleClass)(this._el,"slider_blocked",e)},l.prototype.getBlocked=function(){return this.blocked},l.prototype.isBlocked=function(){return this.isAdMode()||this.getBlocked()},l.prototype.toggleLoading=function(e){e=!!e,(0,a.toggle)(this._progressEl,e),(0,a.setStyle)(this._progressEl,"opacity",e?1:0)},l.prototype.destroy=function(e){this.options.formatHint&&((0,o.removeEvent)(this._el,"mousemove",this._ev_onMouseOver),(0,o.removeEvent)(this._el,"mouseleave",this._ev_onMouseLeave),(0,o.removeEvent)(this._el,"mousedown",this._ev_onMouseDown)),(0,a.re)(this._el),(0,a.re)(this._currHintEl)},l.prototype._updateHint=function(e,t){this._currHintEl||(this._currHintEl=(0,a.se)('<div class="slider_hint" id="slider_hint"></div>'),this.options.hintClass&&(0,a.addClass)(this._currHintEl,this.options.hintClass),this._el.appendChild(this._currHintEl)),this._width=this._width||(0,a.getSize)(this._slideEl)[0];const i=this._getPos();let r=Math.round(e.pageX-i[0]);const s=this._width;if(r=t?Math.min(Math.max(0,r),s):r,r>=0&&r<=s){const e=r/s;this._currHintEl.innerHTML=this.options.formatHint?this.options.formatHint.call(this,e):e;const i=(0,a.getSize)(this._currHintEl);(0,a.setStyle)(this._currHintEl,{left:this._slideEl.offsetLeft+r-i[0]/2,top:this._slideEl.offsetTop-i[1]-10}),!t&&this._toggleHint(!0)}else!t&&this._toggleHint(!1);this.options.formatHint||this._toggleHint(!1)},l.prototype._toggleHint=function(e){this.isAdMode()&&(e=!1),(0,a.toggleClass)(this._currHintEl,"visible",e)},l.prototype._onMouseOver=function(e){l._currenSliderDrag||(0,a.hasClass)(this._el,"active")||this._updateHint(e)},l.prototype._onMouseLeave=function(e){(0,a.hasClass)(this._el,"active")||this._toggleHint(!1)},l.prototype._onMouseDown=function(e){0==e.button&&(delete cur._sliderMouseUpNowEl,this._adState||this.getBlocked()||((0,o.addEvent)(window,"mousemove",this._ev_onMouseMove=this._onMouseMove.bind(this)),(0,o.addEvent)(window,"mouseup",this._ev_onMouseUp=this._onMouseUp.bind(this)),this._width=(0,a.getSize)(this._slideEl)[0],this._onMouseMove(e),l._currenSliderDrag=this,(0,a.addClass)(this._el,"active"),(0,o.cancelEvent)(e)))},l.prototype._onMouseUp=function(e){cur._sliderMouseUpNowEl=this._el,(0,o.removeEvent)(window,"mousemove",this._ev_onMouseMove),(0,o.removeEvent)(window,"mouseup",this._ev_onMouseUp),clearTimeout(this._debounceto),this._onValueChange(),(0,a.removeClass)(this._el,"active"),l._currenSliderDrag=!1,this._toggleHint(!1),this.options.onEndDragging&&this.options.onEndDragging(this._currValue)},l.prototype._onMouseMove=function(e){const t=this._getPos();let i=Math.max(e.pageX,t[0]);i=Math.min(i,t[0]+this._width),i-=t[0],this.setValue(i/this._width,!0,!0),this._onValueChangeDebounced?this._onValueChangeDebounced():this._onValueChange(),this._toggleHint(!0),this._updateHint(e,!0),(0,o.cancelEvent)(e)},l.prototype._getPos=function(){return this._slidePos=(0,a.getXY)(this._slideEl)},l.LOGFBASE=35,l.prototype._logf=function(e){if(!this.options.log)return e;const t=l.LOGFBASE;return(Math.pow(t,e)-1)/(t-1)},l.prototype._unlogf=function(e){if(!this.options.log)return e;const t=l.LOGFBASE;return i=t,a=1+e*(t-1),Math.log(a)/Math.log(i);var i,a},l.prototype.setValue=function(e,t,i){if((0,a.hasClass)(this._el,"active")&&!i)return;const r=i?this._logf(e):e;if(this._currValue==r)return;this._currValue=r;let s=i?e:this._unlogf(e);s=100*s+"%",(0,a.setStyle)(this._amountEl,{width:s}),(0,a.setStyle)(this._handlerEl,{left:s}),!t&&this._onValueChange()},l.prototype.setBackValue=function(e){(0,a.toggleClass)(this._backEl,"slider_back_transition",e>this._backValue),this._backValue=e;const t=100*e+"%";(0,a.setStyle)(this._backEl,{width:t})},l.prototype._onValueChange=function(){this._lastValue=this._lastValue||0,this._lastValue!=this._currValue&&(this._lastValue=this._currValue,this.options.onChange&&this.options.onChange(this._currValue))};const c=l},842856:(e,t,i)=>{i.d(t,{ArticleCommentsBackgroundClass:()=>E,ArticleCommentsBackgroundEditClass:()=>A,ArticleCommentsBackgroundHoverClass:()=>S,ArticleEditorDragButtonClass:()=>w,ArticleEditorInnerComponentsClass:()=>b,ArticleEditorParagraphClass:()=>v,ArticleEditorParagraphToolsClass:()=>f,BULLET_LIST_START:()=>m,CURSOR_MARKER_END:()=>_,CURSOR_MARKER_START:()=>d,Key:()=>N,MAX_DOM_DEPTH:()=>p,MAX_LISTS_LEVEL:()=>h,MIN_LISTS_LEVEL:()=>u,MIN_LIST_START:()=>y,NBSP:()=>o,NBSP_UNICODE:()=>n,NUMERIC_LIST_START:()=>g,ObjectResizeType:()=>s,ParagraphType:()=>a,ResizableObjectTypes:()=>r,Space:()=>l,TABLE_CELL_BG_COLORS:()=>x,TABLE_CELL_DEFAULT_BG:()=>D,TABLE_CELL_DEFAULT_HEIGHT:()=>L,TABLE_CELL_DEFAULT_WIDTH:()=>C,TABLE_CELL_INITIAL_WIDTH:()=>T,TABLE_CELL_MIN_WIDTH:()=>I,TABLE_DEFAULT_COLUMNS_COUNT:()=>O,TABLE_DEFAULT_LEFT_OFFSET:()=>M,TABLE_DEFAULT_ROWS_COUNT:()=>P,TABLE_EDITOR_PADDING:()=>B,TABLE_MIN_WIDTH:()=>k,ZERO_WIDTH_SPACE:()=>c});const a={Text:1,Header1:2,Header2:3,Header3:4,Code:5,NumericList:6,BulletList:7,Quote:8,Quote2:9,Table:10,TableRow:11,TableCell:12,ObjectAudioPlaylist:100,ObjectPhoto:101,ObjectVideo:102,ObjectGIF:103,ObjectPodcast:104,ObjectAudio:105,ObjectTwitter:106,ObjectFacebook:107,ObjectInstagram:108,ObjectVK:109,ObjectTelegram:110,ObjectPoll:111,ObjectMarketItem:112,ObjectAliExpressProduct:113},r=[a.ObjectPhoto,a.ObjectGIF,a.ObjectVideo,a.ObjectTwitter,a.ObjectFacebook,a.ObjectInstagram,a.ObjectVK,a.ObjectTelegram],s={Normal:0,Float:1,Medium:2,Large:3},o="&nbsp;",n=" ",l=" ",c="\ufeff",d="​",_="‌",h=3,u=1,p=2*h+4+10+8,g=/^\d+\./,m=/^(\*|-)/,y=1,v="_article_paragraph",w="article_ed_hover_line",f="article_ed_paragraph_tools",b="article_inner_component",E="ArticleComments__text",S="ArticleComments__text--hover",A="ArticleComments__text--edit",k=720,T=240,C=180,L=42,I=80,O=3,P=3,M=-65,B=35,x=["standard","green","red","blue","orange","yellow","purple"],D="standard",N={KeyA:65,KeyB:66,KeyC:67,KeyI:73,KeyS:83,KeyY:89,KeyZ:90,Apostrophe:192,Backspace:8,Enter:13,Space:32,Up:38,Down:40,Delete:46,Tab:9,Esc:27}},390122:(e,t,i)=>{i.d(t,{Scroll:()=>a});class a{handleMouseDownX(e){this.scrollLeft=this.content.scrollLeft,this.mouseX=e.clientX,document.addEventListener("mousemove",this.handleMouseMoveX),document.addEventListener("mouseup",this.handleMouseUpX),this.onDragStart&&this.onDragStart()}handleMouseMoveX(e){const t=e.clientX-this.mouseX;this.content.scrollLeft=this.scrollLeft+t/this.scrollXRatio}handleMouseUpX(){document.removeEventListener("mousemove",this.handleMouseMoveX),document.removeEventListener("mouseup",this.handleMouseMoveX),this.onDragEnd&&this.onDragEnd()}handleScrollContent(){requestAnimationFrame((()=>{this.xScrollBarInner&&(this.onScrollX&&this.onScrollX(this.content.scrollLeft),this.xScrollBarInner.style.left=100*this.content.scrollLeft/this.content.scrollWidth+"%")}))}handleClickXOuter(e){if(!this.xScrollBarOuter||!this.content||e.target===this.xScrollBarInner)return;const t=this.xScrollBarOuter.getBoundingClientRect(),i=(e.clientX-t.left)/t.width;this.content.scrollLeft=i*(this.content.scrollWidth-this.content.offsetWidth)}updateXScrollBar(){const{offsetWidth:e,scrollWidth:t}=this.content;var i;if(e>=t)return null==(i=this.xScrollBarContainer)||i.remove(),this.xScrollBarContainer=null,this.xScrollBarOuter=null,void(this.xScrollBarInner=null);this.xScrollBarContainer||(this.xScrollBarContainer=document.createElement("div"),this.xScrollBarContainer.classList.add("ArticleScrollBarContainer","ArticleScrollBarContainer--horizontal"),this.xScrollBarOuter=document.createElement("div"),this.xScrollBarOuter.classList.add("ArticleScrollBarOuter"),this.xScrollBarInner=document.createElement("div"),this.xScrollBarInner.classList.add("ArticleScrollBarInner"),this.xScrollBarInner.addEventListener("mousedown",this.handleMouseDownX),this.xScrollBarOuter.addEventListener("click",this.handleClickXOuter),this.xScrollBarContainer.append(this.xScrollBarOuter),this.xScrollBarOuter.append(this.xScrollBarInner),this.container.append(this.xScrollBarContainer)),this.scrollXRatio=this.content.offsetWidth/this.content.scrollWidth,this.xScrollBarInner&&(this.xScrollBarInner.style.width=100*this.scrollXRatio+"%")}update(){this.updateXScrollBar()}setScrollX(e){this.content.scrollLeft=e}hideScrollX(){this.xScrollBarContainer&&(this.xScrollBarContainer.style.visibility="hidden")}showScrollX(){this.xScrollBarContainer&&(this.xScrollBarContainer.style.visibility="visible")}constructor(e){this.xScrollBarContainer=null,this.xScrollBarOuter=null,this.xScrollBarInner=null,this.handleMouseDownX=this.handleMouseDownX.bind(this),this.handleMouseMoveX=this.handleMouseMoveX.bind(this),this.handleMouseUpX=this.handleMouseUpX.bind(this),this.handleScrollContent=this.handleScrollContent.bind(this),this.handleClickXOuter=this.handleClickXOuter.bind(this),e.articleScroll=this,this.container=e,this.container.classList.add("ArticleScrollWrapper"),this.content=document.createElement("div"),this.content.classList.add("ArticleScrollContent"),this.content.setAttribute("contenteditable","false"),this.content.addEventListener("scroll",this.handleScrollContent),this.content.append(...Array.from(this.container.children)),this.container.append(this.content),this.update()}}},564431:(e,t,i)=>{i.d(t,{cancelEvent:()=>n,createElement:()=>u,domClosestOverflowHidden:()=>s,domClosestPositioned:()=>o,findClosestElementWithSelector:()=>h,getSize:()=>d,getXY:()=>l,scrollGetX:()=>a,scrollGetY:()=>r,traverseParent:()=>_});const a=()=>window.scrollX||document.documentElement.scrollLeft,r=()=>window.scrollY||document.documentElement.scrollTop,s=e=>{let t,i,a,r,s=e;for(;s&&s.tagName&&s!==document.body;){const o=window.getComputedStyle(s);if(t=o.position,i=o.overflow,a=o.transform,s!==e&&"visible"!==i&&("static"===t?!r||"relative"===r:"fixed"!==r))break;"none"!==a?r=null:"static"!==t&&"fixed"!==r&&(r=t),s=s.parentElement}return s},o=(e,t={})=>{let i=(t=t||{}).fromEl||e.parentElement;const a=t.positions||["relative","absolute","fixed"];for(;i&&i!==document.body;){const e=window.getComputedStyle(i),r=e.position;if(a.includes(r)&&(!t.noOverflow||"hidden"!==e.overflow))break;i=i.parentElement}return i};function n(e){return!!(e=e||window.event)&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.cancelBubble=!0,e.returnValue=!1,!1)}const l=(e,t)=>{const i=e.ownerDocument;if(!i)return[0,0];const a=i.documentElement,r=e.getBoundingClientRect();return[r.left+(t?0:window.scrollX||a.scrollLeft)-(a.clientLeft||0),r.top+(t?0:window.scrollY||a.scrollTop)-(a.clientTop||0)]},c=(e,t)=>{const i=e.getBoundingClientRect(),a=[i.width,i.height];if(!t)return a;const r=window.getComputedStyle(e);return a[0]-=parseFloat(r.paddingLeft)||0,a[0]-=parseFloat(r.borderLeftWidth)||0,a[0]-=parseFloat(r.paddingRight)||0,a[0]-=parseFloat(r.borderRightWidth)||0,a[1]-=parseFloat(r.paddingTop)||0,a[1]-=parseFloat(r.borderTopWidth)||0,a[1]-=parseFloat(r.paddingBottom)||0,a[1]-=parseFloat(r.borderBottomWidth)||0,a},d=(e,t=!1)=>{var i;let a=[0,0];const r=e instanceof HTMLElement?window.getComputedStyle(e):null;if(t&&"border-box"===(null==(i=r)?void 0:i.boxSizing)&&(t=!1),e)if(r&&"none"===r.display){const i=e.style.cssText.includes("!important")?e.style.cssText:"",r={position:e.style.position,visibility:e.style.visibility,display:e.style.display};e.style.position="absolute",e.style.visibility="hidden",e.style.display="block",a=c(e,t),e.style.position=r.position,e.style.visibility=r.visibility,e.style.display=r.display,i&&(e.style.cssText=i)}else a=c(e,t);return a};function _(e,t,i=999){for(;e&&!t(e);){if(0===--i)return!1;try{if(!e.parentNode||e.parentNode===document)return!1;e=e.parentNode}catch(e){return!1}}return e}function h(e,t){var i;return t.nodeType===Node.ELEMENT_NODE?t.closest(e):null==(i=t.parentElement)?void 0:i.closest(e)}const u=(e,t="div")=>{const i=document.createElement(t);return i.innerHTML=e.trim(),i.firstElementChild}},487277:(e,t,i)=>{i.d(t,{ALLOWED_FILE_TYPES_FOR_PASTE:()=>g,ArticleStatsEvents:()=>l,changeHeightInstagramEmbed:()=>p,getAppropriateImage:()=>c,getUrlParam:()=>u,isArticleEditorAvailable:()=>m,mailruStatsPixel:()=>h,preloadImage:()=>_});var a=i(577686),r=i(231305),s=i(86548),o=i(414126),n=i(6511);const l={clickOnVideo:"click_on_video",clickOnAudio:"click_on_audio",clickOnPhoto:"click_on_photo",clickOnExternalLink:"external_link_click",clickOnCarouselNext:"click_on_carousel_next",clickOnCarouselPrev:"click_on_carousel_prev",clickOnMentions:"click_on_mentions",nightModeOn:"night_mod_on",nightModeOff:"night_mod_off",close:"close"};function c(e,t,i){let r=[];if((0,a.each)(e,((e,t)=>{i&&!["w","z","y","x","m","s"].includes(e)||r.push(t)})),!r.length)return[!1];r.sort(((e,t)=>e[1]-t[1])),t*=window.devicePixelRatio>=2?2:1;let s=r[r.length-1];return(0,a.each)(r,((e,i)=>{if(i[1]>=t)return s=i,!1})),s}let d={};function _(e,t){if(!0===d[e])return t&&t(),!0;if(Array.isArray(d[e]))return d[e].push(t),!1;d[e]=[t];const i=new Image;return i.onload=()=>{let t=d[e];d[e]=!0,(0,a.each)(t,((e,t)=>{t&&t()}))},i.src=e,!1}function h(e,t){if((0,a.isObject)(t)&&!(0,a.isEmpty)(t)){let i=`https://vk-callback.go.mail.ru/longread_pxl?action=${e}`;(0,a.each)(t,((e,t)=>{i+=`&${e}=${t}`}));(new Image).src=i}}function u(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const i=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t||location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function p(e){if(!/^https?:\/\/([\w-]+\.)*(instagram\.com|instagr\.am)$/.test(e.origin))return;const t=function(e){const t=document.getElementsByTagName("iframe");let i;for(let a=t.length-1;a>=0;a--){const r=t[a];if(r.contentWindow===e.source){i=r;break}}return i}(e);if(t){try{e=JSON.parse(e.data)}catch(e){}"object"==typeof e&&"string"==typeof e.type&&"object"==typeof e.details&&setTimeout((()=>{if("MEASURE"===e.type){const{height:i}=e.details;t.setAttribute("height",i)}}),100)}}const g=(0,o.partConfigEnabled)("article_cover_go_upload")?n.GO_UPLOAD_FILE_TYPES.join(";"):"*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;*.gif;*.GIF";function m(){return!(0,s.isMvk)()&&!(r.browser.msie&&parseInt(r.browser.version)<=11)}},6511:(e,t,i)=>{i.d(t,{DEFAULT_ACCEPT:()=>a,GO_UPLOAD_FILE_TYPES:()=>r,MULTIPLE_BATCH_SIZE:()=>s,MULTIPLE_MAX_COUNT:()=>o});const a=["image/jpeg","image/png","image/gif","image/heic","image/heif","image/webp"],r=["*.jpg","*.JPG","*.jpeg","*.JPEG","*.png","*.PNG","*.gif","*.GIF","*.heic","*.HEIC","*.heif","*.HEIF","*.webp","*.WEBP"],s=5242880,o=5},199682:(e,t,i)=>{i.d(t,{ArticleTtsActionType:()=>a,articleTtsActionStatController:()=>s});var a,r=i(725927);!function(e){e.START="start",e.PAUSE="pause",e.CONTINUE="continue",e.SEEK="seek",e.CLOSE="close",e.P10="10p",e.P25="25p",e.P50="50p",e.P75="75p",e.P95="95p",e.P99="99p",e.P100="100p"}(a||(a={}));const s=new class{logEvent(e,t){const i={type:"type_marusia_reading_item",type_marusia_reading_item:e};this.actionStatCollector.logEvent(i,t)}constructor(){this.productStatCollector=new r.ProductionStatCollector,this.actionStatCollector=new r.ActionStatCollector(this.productStatCollector)}}},124353:(e,t,i)=>{i.d(t,{ArticleLayerPhotoOpen:()=>d});var a=i(487277),r=i(764646),s=i(577686),o=i(538248);let n,l,c;const d={open(e,t,i){const[r,s,c]=(0,a.getAppropriateImage)(e[0],window.innerWidth,!0),d=_({width:s,height:c},{width:window.innerWidth,height:window.innerHeight}),h=(0,o.getW)(i)<d.width&&(0,o.getH)(i)<d.height;if(!r||!h)return;const u=(0,o.se)('<div class="article_full_view"><img class="article_full_view__image"></div>'),p=(0,o.geByTag1)("figcaption",i);p&&p.innerHTML&&u.appendChild((0,o.se)(`<div class="article_full_view__caption"><div class="article_full_view__caption_inner">${p.innerHTML}</div></div>`)),l=(0,o.se)('<div class="article_full_view__counter"><div class="article_full_view__counter_text"></div><div class="article_full_view__close"></div></div>'),u.appendChild(l),e.length>1&&(0,o.toggleClass)(l,"article_full_view__carousel",e.length>1);(0,o.geByClass1)("_article_layer").appendChild(u),u.addEventListener("click",(e=>{(0,o.domClosest)("article_full_view__caption_inner",e.target)||this.close()})),u.addEventListener("mousewheel",this.close),n=u;const g=(0,o.geByTag1)("img",u);this._showImage(g,e,t),window.articleCloseImageFullSize=this.close.bind(this)},_showImage(e,t,i){if((0,o.toggleClass)(undefined,"article_full_view__nav_hidden",0==i),(0,o.toggleClass)(undefined,"article_full_view__nav_hidden",i==t.length-1),t.length>1){(0,o.geByClass1)("article_full_view__counter_text",l).innerHTML=r.getLang("global_article_carousel_counter").replace("{counter}",String(i+1)).replace("{total}",String(t.length))}c=i;let n=!1;const[d,h,u]=(0,a.getAppropriateImage)(t[i],window.innerWidth,!0),p=_({width:h,height:u},{width:window.innerWidth,height:window.innerHeight});if((0,a.preloadImage)(d,(()=>{if(c===i){n=!0,p.width&&(0,s.isNumeric)(p.width)?(0,o.setStyle)(e,{width:p.width,height:p.height}):(0,o.setStyle)(e,{width:null,height:null}),e.src=d,(0,o.removeClass)(e,"article_full_view__image_blurred");for(let e=i;e<Math.min(i+3,t.length);e++){const[i]=(0,a.getAppropriateImage)(t[e],window.innerWidth,!0);(0,a.preloadImage)(i)}}})))(0,o.removeClass)(e,"article_full_view__image_blurred");else{const[r]=(0,a.getAppropriateImage)(t[i],200,!0);(0,a.preloadImage)(r,(()=>{c===i&&(n||((0,o.setStyle)(e,{width:p.width,height:p.height}),e.src=r))})),(0,o.addClass)(e,"article_full_view__image_blurred")}},close:()=>(delete window.articleCloseImageFullSize,!!n&&((0,o.re)(n),n=null,!0))};function _(e,t){const i=e.width/e.height,a={width:0,height:0};return i>t.width/t.height?(a.width=Math.min(t.width,e.width),a.height=e.height*(a.width/e.width)):(a.height=Math.min(t.height,e.height),a.width=a.height*i),a}},147419:(e,t,i)=>{i.d(t,{Summary:()=>k});var a=i(564431),r=i(87330),s=i(764646),o=i(946495),n=i(548632);const l=s.getLang("pages_article_summary_hint"),c=[s.getLang("pages_article_summary_loader_1"),s.getLang("pages_article_summary_loader_2"),s.getLang("pages_article_summary_loader_3")],d=s.getLang("pages_article_summary_content_title"),_=s.getLang("pages_article_summary_error_message"),h=s.getLang("pages_article_summary_feedback_title"),u=s.getLang("pages_article_summary_feedback_like"),p=s.getLang("pages_article_summary_feedback_dislike"),g=s.getLang("pages_article_summary_feedback_thanks"),m=s.getLang("pages_article_summary_feedback_thanks_description"),y=s.getLang("pages_article_summary_feedback_qiuz_title"),v=[{text:s.getLang("pages_article_summary_feedback_qiuz_question_1"),code:1},{text:s.getLang("pages_article_summary_feedback_quiz_question_2"),code:2},{text:s.getLang("pages_article_summary_feedback_quiz_question_3"),code:3}],w=s.getLang("pages_article_summary_feedback_quiz_button"),f="create_thesis",b="articles:viewer_ai_summarize",E={rating:1,ratingReason:0},S={rating:0,ratingReason:0},A={rating:0,ratingReason:0};class k{initFirstOpenHint(){this.firstOpenHint=this.initHint(!0),this.firstHintShowTimeout=setTimeout((()=>{this.wrapper.append(this.firstOpenHint),this.sendHideHint()}),1e3),setTimeout((()=>{this.firstOpenHint.remove()}),6e3)}initHint(e=!1){const t=(0,a.createElement)(`<div class="article_summary_hint_wrapper ${!e&&"article_summary_hint_wrapper-secondary"}"></div>`),i=(0,a.createElement)(`<div class="article_summary_hint_content">${l}</div>`),r=(new DOMParser).parseFromString('<svg width="20" height="9" viewBox="0 0 20 9" xmlns="http://www.w3.org/2000/svg" class="article_summary_hint_popper"><path d="M10 0c3 0 6 8 10 8v1H0V8c3.975 0 7-8 10-8Z" fill="currentColor"></path></svg>',"text/html").getElementsByTagName("svg")[0];return t.prepend(i),t.prepend(r),t}initEvents(){this.btn.addEventListener("mouseover",(()=>{this.isDisabled||this.setAction("showHint")})),this.btn.addEventListener("mouseout",(()=>{this.isDisabled||this.setAction("removeHint")})),this.btn.addEventListener("click",(()=>{this.isDisabled||this.setAction("openSummary")})),this.documentCloseEvent=e=>{this.isDisabled||e.target instanceof Element&&(e.target.closest(".article_summary_wrapper")||!document.body.contains(e.target))||this.setAction("closeSummary")},document.addEventListener("click",this.documentCloseEvent)}initLoader(){return(0,a.createElement)('<div class="article_summary_loader_wrapper article_summary_modal_card"></div>')}initSummaryBlock(){const e=(0,a.createElement)('<div class="article_summary_summary_wrapper article_summary_modal_card"></div>'),t=(0,o.getIcon20CheckCircleOutline)().icon,i=(0,a.createElement)(`<div class="article_summary_summary_title"><div class="article_summary_summary_title_icon">${t}</div> ${d}</div>`);e.prepend(i);const r=(0,a.createElement)('<div class="article_summary_summary_list_wrapper"></div>'),s=(0,a.createElement)('<ol class="article_summary_summary_list"></ol>');return this.summaryList=s,r.append(s),s.addEventListener("scroll",(()=>{r.classList.toggle("article_summary_summary_list_wrapper-gradientTop",s.scrollTop>5),r.classList.toggle("article_summary_summary_list_wrapper-gradientBottom",s.scrollTop+s.clientHeight<s.scrollHeight-5)})),this.summaryText.forEach((e=>{const t=document.createElement("li");t.classList.add("article_summary_summary_list_item"),t.textContent=e,s.append(t)})),e.append(r),e}setSummaryListHeight(){let e=document.documentElement.clientHeight-224-284;e<60?e=60:e>428&&(e=428),this.summaryList.style.maxHeight=e+"px"}appendSummaryBlock(){this.wrapper.append(this.summary);const e=this.summaryList;var t,i;(this.setSummaryListHeight(),this.isFeedbackAvailable||this.wrapper.append(this.feedback),e&&e.clientHeight!==e.scrollHeight)?null==(t=this.summary.querySelector(".article_summary_summary_list_wrapper"))||t.classList.add("article_summary_summary_list_wrapper-gradientBottom"):null==(i=this.summary.querySelector(".article_summary_summary_list_wrapper"))||i.classList.remove("article_summary_summary_list_wrapper-gradientBottom")}initFeedback(){const e=(0,a.createElement)(`<div class="article_summary_feedback_btn" id="summary-like">${p}</div>`),t=(0,a.createElement)(`<div class="article_summary_feedback_btn" id="summary-dislike">${u}</div>`),i=(0,a.createElement)('<div class="article_summary_feedback_btn_wrapper"></div>');i.append(t),i.append(e);const r=(0,a.createElement)(`<div class="article_summary_modal_card article_summary_feedback_wrapper">\n            <div class="article_summary_feedback_title">${h}</div>\n        </div>`);r.append(i);const s=(0,n.getIcon20Cancel)().icon,o=(0,a.createElement)(`<botton class="article_summary_modal_close_btn">${s}</botton>`);return o.addEventListener("click",(()=>{this.feedback&&this.feedback.remove()})),r.append(o),t.addEventListener("click",(()=>{this.setAction("chooseLike")})),e.addEventListener("click",(()=>{this.setAction("chooseDislike")})),r}initFeedbackThanks(){const e=(0,a.createElement)(`<div class="article_summary_modal_card article_summary_feedbackThanks_wrapper">\n            <div class="article_summary_feedbackThanks_title">${g}</div>\n            <div class="article_summary_feedbackThanks_description">${m}</div>\n        </div>`),t=(0,n.getIcon20Cancel)().icon,i=(0,a.createElement)(`<botton class="article_summary_modal_close_btn">${t}</botton>`);return i.addEventListener("click",(()=>{this.feedbackThanks&&this.feedbackThanks.remove()})),e.append(i),e}initErrorMessage(){return(0,a.createElement)(`<div class="article_summary_modal_card article_summary_error_wrapper">\n            ${_}\n        </div>`)}initFeedbackQuiz(){const e=(0,a.createElement)(`<div class="article_summary_modal_card article_summary_feedbackQuiz_wrapper">\n            <div class="article_summary_feedbackQuiz_title">${y}</div>\n        </div>`),t=[];v.forEach((i=>{const r=(0,a.createElement)('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" class="article_summary_feedbackThanks_checkbox"><circle cx="12" cy="12" r="11" stroke="currentColor" stroke-width="2" fill="none"></circle><circle cx="12" cy="12" r="7.5" class="article_summary_feedbackThanks_checkbox_pin" fill="currentColor"></circle></svg>'),s=(0,a.createElement)(`<div class="article_summary_feedbackThanks_item" data-reason="${i.code}">${i.text}</div>`);s.prepend(r),t.push(s),e.append(s)}));const i=(0,a.createElement)(`<div class="article_summary_feedbackQuiz_button">${w}</div>`);e.append(i),i.addEventListener("click",(()=>{this.setAction("sendQuizAnswer")})),t.forEach(((e,i)=>{0===i&&e.classList.add("article_summary_feedbackThanks_checkbox-active"),e.addEventListener("click",(()=>{t.forEach((e=>{e.classList.remove("article_summary_feedbackThanks_checkbox-active")})),e.classList.add("article_summary_feedbackThanks_checkbox-active"),this.dislikeState.ratingReason=Number(e.getAttribute("data-reason"))||0}))}));const r=(0,n.getIcon20Cancel)().icon,s=(0,a.createElement)(`<botton class="article_summary_modal_close_btn">${r}</botton>`);return s.addEventListener("click",(()=>{this.feedbackQuiz&&this.feedbackQuiz.remove()})),e.append(s),e}startLoader(){let e=Math.floor(Math.random()*c.length);this.loaderInterval=setInterval((()=>{e++,e===c.length&&(e=0),this.loader.textContent=c[e]+"..."}),2e3),this.loader.textContent=c[e]+"...",this.wrapper.append(this.loader)}getSummary(){return this.btn.setAttribute("disabled",""),this.isLoading=!0,(0,r.api)("articles.summarize",{owner_id:this.ownerId,article_id:this.articleId,type:"theses"})}getHintData(){(0,r.api)("account.getHelpHints",{}).then((e=>{e.items.find((e=>e.id===b))&&this.initFirstOpenHint()})).catch((e=>{console.log("getHintData error",e)}))}sendHideHint(){(0,r.api)("account.hideHelpHint",{hint_id:b}).catch((e=>{console.log("sendHideHint error",e)}))}sendDislikeNoReason(){this.sendDislikeNoReasonTimeout=setTimeout((()=>{this.sendFeedBack(S.rating,S.ratingReason)}),3e4),this.addCloseWindowSendStatEvent()}addCloseWindowSendStatEvent(){this.documentSendStatEvent=()=>{this.sendFeedBack(S.rating,S.ratingReason)},document.addEventListener("onunload",this.documentSendStatEvent,{once:!0})}removeCloseWindowSendStatEvent(){this.documentSendStatEvent&&document.removeEventListener("onunload",this.documentSendStatEvent)}cancelLoader(){clearInterval(this.loaderInterval),this.loader.remove()}setAction(e){if(e!==this.lastAction){switch(e){case"showHint":if(this.firstOpenHint&&(clearInterval(this.firstHintShowTimeout),this.firstOpenHint.remove()),this.summary&&document.body.contains(this.summary)||this.loader&&document.body.contains(this.loader))return;this.wrapper.append(this.hint);break;case"removeHint":this.hint&&document.body.contains(this.hint)&&(this.firstOpenHint&&this.firstOpenHint.remove(),this.hint.remove());break;case"openSummary":if(this.btn.classList.add("article_summary_btn-hover-disable"),this.loader&&document.body.contains(this.loader)||this.summary&&document.body.contains(this.summary))return;if(this.isLoading)return void this.startLoader();this.hint.remove(),this.firstOpenHint&&this.firstOpenHint.remove(),this.sendAnalytics(f),this.summaryText?(this.summary||(this.summary=this.initSummaryBlock()),this.appendSummaryBlock()):(this.startLoader(),this.getSummary().then((e=>{this.btn.removeAttribute("disabled"),this.isLoading=!1,this.summaryText=e.text,this.isFeedbackAvailable=e.is_theses_feedback_available,this.isDisabled||(this.cancelLoader(),this.summary=this.initSummaryBlock(),this.appendSummaryBlock())})).catch((e=>{this.btn.removeAttribute("disabled"),this.isLoading=!1,this.isDisabled||(this.cancelLoader(),this.summary=this.errorMessage,this.wrapper.append(this.summary),console.log("getSummary error",e))})));break;case"chooseLike":this.feedback.remove(),this.sendFeedBack(E.rating,E.ratingReason),this.wrapper.append(this.feedbackThanks);break;case"chooseDislike":this.feedback.remove(),this.wrapper.append(this.feedbackQuiz),this.sendDislikeNoReason(),this.dislikeState.isDislike=!0;break;case"sendQuizAnswer":this.feedbackQuiz.remove(),this.wrapper.append(this.feedbackThanks),clearTimeout(this.sendDislikeNoReasonTimeout),this.removeCloseWindowSendStatEvent(),this.sendFeedBack(A.rating,this.dislikeState.ratingReason);break;case"closeSummary":this.btn.classList.remove("article_summary_btn-hover-disable"),this.hint.remove(),this.firstOpenHint&&this.firstOpenHint.remove(),this.cancelLoader(),this.feedback.remove(),this.feedbackQuiz.remove(),this.feedbackThanks.remove(),this.errorMessage.remove(),this.summary&&this.summary.remove()}this.lastAction=e}}sendFeedBack(e,t){this.isFeedbackAvailable=!0,(0,r.api)("articles.storeSummarizationFeedback",{owner_id:this.ownerId,article_id:this.articleId,type:"theses",rating:e,rating_reason:t}).catch((e=>{console.log("sendFeedBack error",e)}))}sendAnalytics(e){this.isOpenedSummary||(this.sendStats({type:e}),this.isOpenedSummary=!0)}getArticleId(){return this.articleId}activate(){if(!this.articleContentEl.contains(this.wrapper)){const e=this.articleContentEl.querySelector(".article_summary_wrapper"),t=this.articleContentEl.querySelector(".article_summary_btn");e&&t&&(this.wrapper=e,this.btn=t),this.initEvents()}this.wrapper.classList.remove("article_summary_wrapper-hidden"),this.isDisabled=!1}disable(){this.setAction("closeSummary"),this.isDisabled=!0,this.wrapper.classList.add("article_summary_wrapper-hidden")}removeEvents(){document.removeEventListener("click",this.documentCloseEvent)}constructor(e,t,i,a,r,s,o){this.isDisabled=!1,this.isLoading=!1,this.isOpenedSummary=!1,this.isFeedbackAvailable=!0,this.dislikeState={isDislike:!1,ratingReason:1},this.articleId=s,this.ownerId=o,this.articleContentEl=i,this.sendStats=a,this.wrapper=e,this.wrapper.classList.remove("article_summary_wrapper-hidden"),this.btn=t,this.hint=this.initHint(),this.loader=this.initLoader(),this.feedback=this.initFeedback(),this.feedbackThanks=this.initFeedbackThanks(),this.errorMessage=this.initErrorMessage(),this.feedbackQuiz=this.initFeedbackQuiz(),r&&this.getHintData(),this.initEvents()}}},204318:(e,t,i)=>{var a,r,s,o=i(481608),n=i(62433);(null==(r=window.vk)||null==(a=r.pe)?void 0:a.static_manager_dynamic_imports)&&(null==(s=window.vk)?void 0:s.stDomain)&&(i.p=window.vk.stDomain+"/dist/"),window.ArticleLayer=o.ArticleLayer,(0,n.init)();try{window.stManager.done(window.jsc("web/article_layer.js"))}catch(e){}},249590:(e,t,i)=>{e.exports=i.p+"icons/6cd8df77fe46e74e759d.png"}},n={};function l(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return o[e].call(i.exports,i,i.exports,l),i.exports}l.m=o,e=[],l.O=(t,i,a,r)=>{if(!i){var s=1/0;for(d=0;d<e.length;d++){for(var[i,a,r]=e[d],o=!0,n=0;n<i.length;n++)(!1&r||s>=r)&&Object.keys(l.O).every((e=>l.O[e](i[n])))?i.splice(n--,1):(o=!1,r<s&&(s=r));if(o){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[i,a,r]},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},i=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var r=Object.create(null);l.r(r);var s={};t=t||[null,i({}),i([]),i(i)];for(var o=2&a&&e;"object"==typeof o&&!~t.indexOf(o);o=i(o))Object.getOwnPropertyNames(o).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,l.d(r,s),r},l.d=(e,t)=>{for(var i in t)l.o(t,i)&&!l.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,i)=>(l.f[i](e,t),t)),[])),l.u=e=>25394===e?"web/chunks/AudioLongtapModal.d3903e62.js":24817===e?"web/chunks/hls.b496ce21.js":75980===e?"web/chunks/menu_settings.bc38080f.js":28063===e?"web/chunks/a8878234.async.219f33fa.js":352===e?"web/chunks/8e751055.async.441a3337.js":91586===e?"web/chunks/997b3f7e.async.ba4f5b36.js":12591===e?"web/chunks/058cc1a4.async.2a30a102.js":90993===e?"web/chunks/ba3a5fe4.async.ae6a61ff.js":48801===e?"web/chunks/181f948b.async.26dee357.js":41527===e?"web/chunks/38bbe176.async.232773ab.js":73142===e?"web/chunks/27d9ab2b.async.cfd7e83e.js":59727===e?"web/chunks/VideoUpload.d210d773.js":9375===e?"web/chunks/voice_message_player.1b8d0859.js":28762===e?"web/chunks/speech.ed86c092.js":57468===e?"web/chunks/SilentModeForms.edb4dd8e.js":28872===e?"web/chunks/feed-client-nav-skeleton.c5b5d195.js":35953===e?"web/chunks/feed-client-nav-async-right-block.9b0b55eb.js":29019===e?"web/chunks/ReportForm.828943c1.js":22854===e?"web/chunks/PublishClipToVideoModal.7eefcec9.js":63969===e?"web/chunks/8e50c364.async.7952eee8.js":72229===e?"web/chunks/VideoEditor.8a1f8e64.js":30271===e?"web/chunks/VideoUploadModal.53fea246.js":31286===e?"web/chunks/VideoExternalUploadModal.2015692c.js":59240===e?"web/chunks/performance-stats.42b66e21.js":74212===e?"web/chunks/"+e+".f60e3da7.js":84670===e?"chunks/"+e+".2d612620.js":51615===e?"chunks/"+e+".0ac520ae.js":void 0,l.miniCssF=e=>25394===e?"web/chunks/6a66a172.css":75980===e?"web/chunks/5bbee2c9.css":59727===e?"web/chunks/20074c02.css":57468===e?"web/chunks/a2979e7d.css":29019===e?"web/chunks/1c452c59.css":22854===e?"web/chunks/70c35bc4.css":72229===e?"web/chunks/689a17db.css":{30271:1,31286:1}[e]?"web/chunks/f89919fd.css":void 0,l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a={},l.l=(e,t,i,r)=>{if(a[e])a[e].push(t);else{var s,o;if(void 0!==i)for(var n=document.getElementsByTagName("script"),c=0;c<n.length;c++){var d=n[c];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")=="vk:"+i){s=d;break}}s||(o=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,l.nc&&s.setAttribute("nonce",l.nc),s.setAttribute("data-webpack","vk:"+i),s.src=e),a[e]=[t];var _=(t,i)=>{s.onerror=s.onload=null,clearTimeout(h);var r=a[e];if(delete a[e],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((e=>e(i))),t)return t(i)},h=setTimeout(_.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=_.bind(null,s.onerror),s.onload=_.bind(null,s.onload),o&&document.head.appendChild(s)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="/dist/",r=e=>new Promise(((t,i)=>{var a=l.miniCssF(e),r=l.p+a;if(((e,t)=>{for(var i=document.getElementsByTagName("link"),a=0;a<i.length;a++){var r=(o=i[a]).getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(r===e||r===t))return o}var s=document.getElementsByTagName("style");for(a=0;a<s.length;a++){var o;if((r=(o=s[a]).getAttribute("data-href"))===e||r===t)return o}})(a,r))return t();((e,t,i,a)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.onerror=r.onload=s=>{if(r.onerror=r.onload=null,"load"===s.type)i();else{var o=s&&("load"===s.type?"missing":s.type),n=s&&s.target&&s.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=o,l.request=n,r.parentNode.removeChild(r),a(l)}},r.href=t,document.head.appendChild(r)})(e,r,t,i)})),s={38816:0},l.f.miniCss=(e,t)=>{s[e]?t.push(s[e]):0!==s[e]&&{22854:1,25394:1,29019:1,30271:1,31286:1,57468:1,59727:1,72229:1,75980:1}[e]&&t.push(s[e]=r(e).then((()=>{s[e]=0}),(t=>{throw delete s[e],t})))},(()=>{l.b=document.baseURI||self.location.href;var e={38816:0};l.f.j=(t,i)=>{var a=l.o(e,t)?e[t]:void 0;if(0!==a)if(a)i.push(a[2]);else{var r=new Promise(((i,r)=>a=e[t]=[i,r]));i.push(a[2]=r);var s=l.p+l.u(t),o=new Error;l.l(s,(i=>{if(l.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var r=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+r+": "+s+")",o.name="ChunkLoadError",o.type=r,o.request=s,a[1](o)}}),"chunk-"+t,t)}},l.O.j=t=>0===e[t];var t=(t,i)=>{var a,r,[s,o,n]=i,c=0;if(s.some((t=>0!==e[t]))){for(a in o)l.o(o,a)&&(l.m[a]=o[a]);if(n)var d=n(l)}for(t&&t(i);c<s.length;c++)r=s[c],l.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return l.O(d)},i=self.webpackChunkvkweb=self.webpackChunkvkweb||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var c=l.O(void 0,[213,2067,20795,84400,83737,57451,71610,5038,95167],(()=>l(204318)));c=l.O(c)})();